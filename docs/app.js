"use strict";(()=>{var t={907:()=>{yodasws.page("pageBlog").setRoute({title:"Blog",canonicalRoute:"/blog/",template(t,...e){const n=e.join("/").replace(/\/+/g,"/").replace(/^\/|\/$/g,"").split("/").filter(t=>""!=t);return 0===n.length?"pages/blog/index.html":{canonicalRoute:"/blog/"+n.join("/")+"/",template:"pages/blog/"+n.join(".")+".html"}},route:"/blog(/.*)*"}).on("load",()=>{})}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}(()=>{"use strict";function t(t,n,r){e(t,n),n.set(t,r)}function e(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(t,e,n){return t.set(o(t,e),n),n}function i(t,e){return t.get(o(t,e))}function o(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function a(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=m(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function s(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(s=function(){return!!t})()}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){v(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function p(t,e,n){return e&&y(t.prototype,e),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function v(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}function m(t,e){if(t){if("string"==typeof t)return b(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}n(907);var w=function(t){return Number.isFinite(t)&&!Number.isNaN(t)},k=function(t){return"object"==g(t)&&null!==t},x=function(t){return k(t)&&w(t.col)&&w(t.row)},O=function(t){return Array.isArray(t)&&w(t[0])&&w(t[1])},S=function(t,e){return e+t*(1&e)>>1},T=function(t,e){return function(t){return(t%8+8)%8}(t+e)},P=function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||m(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,3),n=e[0],r=e[1],i=e[2];return{q:n,r,s:void 0===i?-n-r:i}};function E(t){var e=t.q,n=t.r,r=t.s,i=w(e),o=w(n),a=w(r);if(i&&o&&a)return{q:e,r:n,s:r};if(i&&o)return{q:e,r:n,s:-e-n};if(i&&a)return{q:e,r:-e-r,s:r};if(o&&a)return{q:-n-r,r:n,s:r};throw new TypeError("Can't determine three cube coordinates from less than two coordinates. Received: { q: ".concat(e,", r: ").concat(n,", s: ").concat(r," }."))}var j=function(t){return t.FLAT="FLAT",t.POINTY="POINTY",t}(j||{});var M=function(){return p(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];h(this,t),v(this,"q",void 0),v(this,"r",void 0);var n=U(this,e),r=n.q,i=n.r;this.q=r,this.r=i},[{key:"center",get:function(){var t=this.width,e=this.height;return{x:t/2-this.x,y:e/2-this.y}}},{key:"col",get:function(){return q(this).col}},{key:"corners",get:function(){var t=this.orientation,e=this.width,n=this.height,r=this.x,i=this.y;return t===j.POINTY?A(e,n,r,i):W(e,n,r,i)}},{key:"dimensions",get:function(){return C.dimensions}},{key:"height",get:function(){var t=this.orientation,e=this.dimensions.yRadius;return t===j.POINTY?2*e:e*Math.sqrt(3)}},{key:"isFlat",get:function(){return this.orientation===j.FLAT}},{key:"isPointy",get:function(){return this.orientation===j.POINTY}},{key:"orientation",get:function(){return C.orientation}},{key:"origin",get:function(){return C.origin}},{key:"offset",get:function(){return C.offset}},{key:"row",get:function(){return q(this).row}},{key:"width",get:function(){var t=this.orientation,e=this.dimensions.xRadius;return t===j.POINTY?e*Math.sqrt(3):2*e}},{key:"x",get:function(){return L(this).x}},{key:"y",get:function(){return L(this).y}},{key:"s",get:function(){return-this.q-this.r}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return new this.constructor(t)}},{key:"equals",value:function(t){return function(t,e){if(x(t)&&x(e))return t.col===e.col&&t.row===e.row;if(Object.hasOwn(t,"col")||Object.hasOwn(e,"col"))throw new Error("Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ".concat(JSON.stringify(t)," and ").concat(JSON.stringify(e)));var n=O(t)?P(t):t,r=O(e)?P(e):e;return n.q===r.q&&n.r===r.r}(this,x(t)?F(this,t):t)}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.q,",").concat(this.r,")")}},{key:"translate",value:function(t){return function(t,e){var n=E(t),r=n.q,i=n.r,o=n.s,a=E(e),s={q:r+a.q,r:i+a.r,s:o+a.s};return t instanceof M?t.clone(s):s}(this,t)}}],[{key:"settings",get:function(){var t=this.prototype;return{dimensions:t.dimensions,orientation:t.orientation,origin:t.origin,offset:t.offset}}}])}(),C={dimensions:{xRadius:1,yRadius:1},orientation:j.POINTY,origin:{x:0,y:0},offset:-1},A=function(t,e,n,r){return[{x:n+.5*t,y:r-.25*e},{x:n+.5*t,y:r+.25*e},{x:n,y:r+.5*e},{x:n-.5*t,y:r+.25*e},{x:n-.5*t,y:r-.25*e},{x:n,y:r-.5*e}]},W=function(t,e,n,r){return[{x:n+.25*t,y:r-.5*e},{x:n+.5*t,y:r},{x:n+.25*t,y:r+.5*e},{x:n-.25*t,y:r+.5*e},{x:n-.5*t,y:r},{x:n-.25*t,y:r-.5*e}]};function I(t){var e=f(f({},C),t),n=e.dimensions,r=e.orientation,i=e.origin,o=e.offset;return function(t){function e(){return h(this,e),function(t,e,n){return e=u(e),function(t,e){if(e&&("object"==g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,s()?Reflect.construct(e,n||[],u(t).constructor):e.apply(t,n))}(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(e,t),p(e,[{key:"dimensions",get:function(){return function(t,e){if(k(t)&&t.xRadius>0&&t.yRadius>0)return t;if(k(t)&&t.width>0&&t.height>0){var n=t.width,r=t.height;return e===j.POINTY?{xRadius:n/Math.sqrt(3),yRadius:r/2}:{xRadius:n/2,yRadius:r/Math.sqrt(3)}}if(t>0)return{xRadius:t,yRadius:t};throw new TypeError("Invalid dimensions: ".concat(JSON.stringify(t),". Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number."))}(n,r)}},{key:"orientation",get:function(){return r}},{key:"origin",get:function(){return function(t,e){if(function(t){return k(t)&&w(t.x)&&w(t.y)}(t))return t;if(!e)throw new TypeError("Supply a bounding box ({ width: number, height: number }). Received: ".concat(JSON.stringify(e)));if("topLeft"===t)return{x:-.5*e.width,y:-.5*e.height};throw new TypeError("Invalid origin: ".concat(JSON.stringify(t),". Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'."))}(i,this)}},{key:"offset",get:function(){return o}}])}(M)}var q=function(t){var e=t.q,n=t.r,r=t.offset;return t.isPointy?function(t,e,n){return{col:t+S(n,e),row:e}}(e,n,r):function(t,e,n){return{col:t,row:e+S(n,t)}}(e,n,r)},L=function(t){var e=t.orientation,n=t.dimensions,r=n.xRadius,i=n.yRadius,o=t.origin,a=o.x,s=o.y,u=t.q,c=t.r;return e===j.POINTY?{x:r*Math.sqrt(3)*(u+c/2)-a,y:3*i/2*c-s}:{x:3*r/2*u-a,y:i*Math.sqrt(3)*(c+u/2)-s}},N=function(t,e,n){var r=t-S(n,e);return{q:r,r:e,s:-r-e}},_=function(t,e,n){var r=t,i=e-S(n,t);return{q:r,r:i,s:-r-i}},F=function(t,e){var n=t.offset,r=t.orientation,i=e.col,o=e.row;return r===j.POINTY?N(i,o,n):_(i,o,n)},R=function(t){var e=E(t),n=e.q,r=e.r,i=e.s,o=Math.round(n),a=Math.round(r),s=Math.round(i),u=Math.abs(n-o),c=Math.abs(r-a),l=Math.abs(i-s);return u>c&&u>l?o=-a-s:c>l?a=-o-s:s=-o-a,{q:o,r:a,s}};function U(t,e){return O(e)?P(e):x(e)?F(t,e):E(e)}function H(t,e,n){var r=U(t,e),i=r.q,o=r.r,a=r.s,s=U(t,n),u=s.q,c=s.r,l=s.s;return Math.max(Math.abs(i-u),Math.abs(o-c),Math.abs(a-l))}var D=function(t){return t.CLOCKWISE="CLOCKWISE",t.COUNTERCLOCKWISE="COUNTERCLOCKWISE",t}(D||{}),V=function(t){return t[t.N=0]="N",t[t.NE=1]="NE",t[t.E=2]="E",t[t.SE=3]="SE",t[t.S=4]="S",t[t.SW=5]="SW",t[t.W=6]="W",t[t.NW=7]="NW",t}(V||{}),G=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],z=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],B=function(t,e){return t.clone(t.isPointy?function(t,e){var n=t.offset,r=t.q,i=t.r,o=t.col,a=t.row;if(e===V.S||e===V.N){var s=e===V.S?a+1:a-1;return N(o,s,n)}var u=G[e];return{q:r+u.q,r:i+u.r}}(t,e):function(t,e){var n=t.offset,r=t.q,i=t.r,o=t.col,a=t.row;if(e===V.E||e===V.W){var s=e===V.E?o+1:o-1;return _(s,a,n)}var u=z[e];return{q:r+u.q,r:i+u.r}}(t,e))};function K(t){return Array.isArray(t)?function(e,n){var r,i=[],o=n,s=a(t);try{for(s.s();!(r=s.n()).done;){var u,c=a((0,r.value)(e,o));try{for(c.s();!(u=c.n()).done;){var l=u.value;i.push(o=l)}}catch(t){c.e(t)}finally{c.f()}}}catch(t){s.e(t)}finally{s.f()}return i}:t}function Y(t){return function(t){return t.direction in V}(t)?function(t){var e=t.start,n=t.direction,r=t.length;return function(t,i){var o=[],a=t(null!=e?e:i);!e&&i&&(a=B(a,n));for(var s=0;s<r;s++)o.push(a),a=B(a,n);return o}}(t):function(t){var e=t.start,n=t.stop;return function(t,r){for(var i=[],o=t(null!=e?e:r),a=function(t,e){return function(n){return{q:t.q*(1-n)+e.q*n,r:t.r*(1-n)+e.r*n}}}(J(o),J(U(o,n))),s=H(o,o,n),u=1/Math.max(s,1),c=!e&&r?1:0;c<=s;c++){var l=R(a(u*c));i.push(t(l))}return i}}(t)}function J(t){return{q:t.q+1e-6,r:t.r+1e-6,s:t.s+-2e-6}}function X(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).includeSource,r=void 0===n||n;return function(n,i){var o,s=[],u=a(K(t)(n,i));try{for(u.s();!(o=u.n()).done;){var c=o.value;r&&s.push(c);var l,f=a(K(e)(n,c));try{for(f.s();!(l=f.n()).done;){var h=l.value;s.push(h)}}catch(t){f.e(t)}finally{f.f()}}}catch(t){u.e(t)}finally{u.f()}return s}}function $(t,e){return function(n,r){var i,o=e?function(t,e,n){var r=n.isPointy,i=n.offset,o=Q(t,r,i),a=o.col,s=o.row,u=Q(e,r,i),c=u.col,l=u.row,f=Z[(a<c?"A":"B")+(s<l?"A":"B")],h=f.swapWidthHeight,y=f.direction,p=Math.abs(a-c)+1,v=Math.abs(s-l)+1;return{width:h?v:p,height:h?p:v,start:t,direction:y}}(t,e,n()):t,a=o.width,s=o.height,u=o.start,c=o.direction,l=void 0===c?V.E:c,f=null!==(i=null!=u?u:r)&&void 0!==i?i:[0,0],h=X(Y({start:f,direction:T(l,2),length:s}),Y({direction:l,length:a-1}))(n,f);return!u&&r?h.slice(1):h}}function Q(t,e,n){if(x(t))return t;var r=O(t)?P(t):E(t),i=r.q,o=r.r;return q({q:i,r:o,isPointy:e,offset:n})}var Z={AA:{swapWidthHeight:!1,direction:V.E},AB:{swapWidthHeight:!0,direction:V.N},BA:{swapWidthHeight:!0,direction:V.S},BB:{swapWidthHeight:!1,direction:V.W}};function tt(t){var e=t.center,n=t.rotation,r=void 0===n?D.CLOCKWISE:n;return function(n,i){var o,a,s=r.toUpperCase(),u=[],c=t.radius,l=w(c);l?a=n(e).translate({q:c,s:-c}):c=H(a=n(null!==(o=t.start)&&void 0!==o?o:i),e,a);var f=U(a,e),h=n({q:f.q,r:f.r-c,s:f.s+c});if(s===D.CLOCKWISE)for(var y=0;y<6;y++)for(var p=0;p<c;p++){var v=et[y],d=v.q,m=v.r;h=n({q:h.q+d,r:h.r+m}),u.push(h)}else for(var b=5;b>=0;b--)for(var g=0;g<c;g++){var k=et[b],x=k.q,O=k.r;h=n({q:h.q-x,r:h.r-O}),u.push(h)}var S=!l&&!t.start&&i,T=u.findIndex(function(t){return t.equals(a)});return u.slice(T+(S?1:0)).concat(u.slice(0,T))}}var et=[{q:1,r:0},{q:0,r:1},{q:-1,r:1},{q:-1,r:0},{q:0,r:-1},{q:1,r:-1}];function nt(t){var e=t.radius,n=t.start,r=t.rotation;return function(t,i){var o,a=null!==(o=null!=n?n:i)&&void 0!==o?o:[0,0],s=!n&&i?e:e+1;return X(Y({start:n,direction:V.N,length:s}),tt({center:a,rotation:r}))(t,i)}}var rt=new WeakMap,it=new WeakMap,ot=new WeakSet,at=function(){function n(a){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(h(this,n),function(t,n){e(t,n),n.add(t)}(this,ot),t(this,rt,void 0),t(this,it,new Map),a instanceof n)return r(rt,this,i(rt,a)),void this.setHexes(a);r(rt,this,a),this.setHexes(o(ot,this,ut).call(this,s))}return p(n,[{key:"size",get:function(){return i(it,this).size}},{key:"pixelWidth",get:function(){if(0===this.size)return 0;var t=this.hexPrototype,e=t.isPointy,n=t.width,r=this.toArray(),i=e?r.sort(function(t,e){return e.s-t.s||t.q-e.q}):r.sort(function(t,e){return t.q-e.q}),o=i[0];return i[i.length-1].x-o.x+n}},{key:"pixelHeight",get:function(){if(0===this.size)return 0;var t=this.hexPrototype,e=t.isPointy,n=t.height,r=this.toArray(),i=e?r.sort(function(t,e){return t.r-e.r}):r.sort(function(t,e){return e.s-t.s||t.r-e.r}),o=i[0];return i[i.length-1].y-o.y+n}},{key:Symbol.iterator,value:function(){return i(it,this).values()}},{key:"hexPrototype",get:function(){return i(rt,this).prototype}},{key:"createHex",value:function(t){return new(i(rt,this))(t)}},{key:"getHex",value:function(t){var e=this.createHex(t);return i(it,this).get(e.toString())}},{key:"hasHex",value:function(t){return i(it,this).has(t.toString())}},{key:"setHexes",value:function(t){var e,n=a(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,s=r instanceof M?r:new(i(rt,this))(r);o(ot,this,st).call(this,s)}}catch(t){n.e(t)}finally{n.f()}return this}},{key:"filter",value:function(t){var e,r=new n(i(rt,this)),s=a(this);try{for(s.s();!(e=s.n()).done;){var u=e.value;t(u)&&o(ot,r,st).call(r,u)}}catch(t){s.e(t)}finally{s.f()}return r}},{key:"map",value:function(t){var e,r=new n(i(rt,this)),s=a(this);try{for(s.s();!(e=s.n()).done;){var u=e.value;o(ot,r,st).call(r,t(u))}}catch(t){s.e(t)}finally{s.f()}return r}},{key:"traverse",value:function(t){var e,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).bail,s=void 0!==r&&r,u=new n(i(rt,this)),c=a(o(ot,this,ut).call(this,t));try{for(c.s();!(e=c.n()).done;){var l=e.value,f=this.getHex(l);if(f)o(ot,u,st).call(u,f);else if(s)return u}}catch(t){c.e(t)}finally{c.f()}return u}},{key:"forEach",value:function(t){var e,n=a(this);try{for(n.s();!(e=n.n()).done;)t(e.value)}catch(t){n.e(t)}finally{n.f()}return this}},{key:"reduce",value:function(t,e){if(void 0===e){var n,r,i,o,s=a(this);try{for(s.s();!(o=s.n()).done;){var u=o.value;r=i,i=u,r&&(n=t(r,i))}}catch(t){s.e(t)}finally{s.f()}return n}var c,l=e,f=a(this);try{for(f.s();!(c=f.n()).done;)l=t(l,c.value)}catch(t){f.e(t)}finally{f.f()}return l}},{key:"toArray",value:function(){return Array.from(this)}},{key:"toJSON",value:function(){var t=this.hexPrototype;return{hexSettings:{dimensions:t.dimensions,orientation:t.orientation,origin:t.origin,offset:t.offset},coordinates:this.toArray()}}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.size,")")}},{key:"pointToHex",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).allowOutside,n=void 0===e||e,r=function(t,e){var n=t.dimensions,r=n.xRadius,i=n.yRadius,o=t.origin,a=t.orientation,s=e.x,u=e.y;return s+=o.x,u+=o.y,a===j.POINTY?R({q:Math.sqrt(3)*s/(3*r)-u/(3*i),r:2/3*(u/i)}):R({q:2/3*(s/r),r:Math.sqrt(3)*u/(3*i)-s/(3*r)})}(this.hexPrototype,t),i=this.getHex(r);return n?null!=i?i:this.createHex(r):i}},{key:"distance",value:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside;if(void 0===n||n)return H(this.hexPrototype,t,e);var r=this.getHex(t),i=this.getHex(e);return r&&i?H(this.hexPrototype,r,i):void 0}},{key:"neighborOf",value:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside,r=void 0===n||n,i=B(this.createHex(t),e),o=this.getHex(i);return r?null!=o?o:i:o}}],[{key:"fromIterable",value:function(t){var e=t[Symbol.iterator]().next().value;if(!e)throw new TypeError("Can't create grid from empty iterable: ".concat(JSON.stringify(t)));return new n(e.constructor,t)}},{key:"fromJSON",value:function(t,e){var r=t.hexSettings,i=t.coordinates;if(e){var o=i.map(e);return new n(o.length>0?o[0].constructor:e({q:0,r:0},0,[{q:0,r:0}]).constructor,o)}var a=I(r);return new n(a,i.map(function(t){return new a(t)}))}}])}();function st(t){i(it,this).set(t.toString(),t)}function ut(t){return o(ot,this,ct).call(this,t)?o(ot,this,lt).call(this,t):Array.isArray(t)&&o(ot,this,ct).call(this,t[0])?o(ot,this,lt).call(this,K(t)):t}function ct(t){return"function"==typeof t}function lt(t){return t(this.createHex.bind(this))}var ft=200;void 0===globalThis.window&&(globalThis.window={visualViewport:{height:1080,width:1920}});var ht=function(){return{height:window.visualViewport.height/.5,width:window.visualViewport.width/.5,offscreen:-2*Math.max(window.visualViewport.width,window.visualViewport.height)}},yt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9,r=(t.y-e.y)/(t.x-e.x),i=t.y-r*t.x,o=(t.x-e.x)*n+e.x;return{x:o,y:r*o+i}};const pt=JSON.parse("{\"actions\":[{\"key\":\"move\",\"label\":\"Move here\",\"description\":\"Move to target location\",\"icon\":\"move-to-tile.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"isLegalMove\",\"execute\":\"startMoveTo\"},{\"key\":\"wait\",\"label\":\"Wait\",\"description\":\"Wait and come back later this turn\",\"icon\":\"wait.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":true,\"execute\":\"wait\"},{\"key\":\"skip\",\"label\":\"Skip\",\"description\":\"Skip this unit's turn\",\"icon\":\"skip.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":true,\"execute\":\"skip\"},{\"key\":\"tile\",\"label\":\"Information on space\",\"description\":\"View information about this tile\",\"icon\":\"about-tile.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"hexTileValid\",\"execute\":\"startTileView\"},{\"key\":\"city-view\",\"label\":\"View City\",\"description\":\"View information about this city\",\"icon\":\"city-view.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"isCityTile\",\"execute\":\"startCityView\"},{\"key\":\"build-farm\",\"label\":\"Build Farm\",\"description\":\"Construct a farm on this tile. The farmer unit will be consumed and become a laborer to work the farm.\",\"icon\":\"farm.png\",\"unitTypes\":[\"farmer\"],\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"isFarmBuildable\",\"execute\":\"buildFarm\"},{\"key\":\"end-turn\",\"label\":\"End Turn\",\"description\":\"End Turn\",\"icon\":\"end-turn.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"currentPlayerTurn\",\"execute\":\"endTurn\"}],\"improvements\":{\"farm\":{\"title\":\"Subsistence Farm\",\"tile\":\"farm\",\"housing\":1,\"terrains\":{\"grass\":{\"food\":2,\"turnsForProduction\":1},\"moor\":{\"food\":1,\"turnsForProduction\":1},\"swamp\":{\"food\":2,\"turnsForProduction\":6}}}},\"FactionNames\":[\"Publius Helvius Pertinax\",\"Gaius Flavius Agricola\",\"Brigantes\",\"Catuvellauni\",\"Trinovantes\",\"Dobunni\",\"Cornovii\",\"Atrebates\"],\"NationNames\":[\"Roman Empire\"],\"StandardMovable\":{\"crossCreeks\":1.25,\"crossStreams\":1.5,\"moveOnLand\":true,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"canal\":12,\"stream\":12,\"river\":24,\"desert\":12,\"grass\":12,\"hill\":18,\"marsh\":18,\"moor\":12,\"mountain\":24,\"oceans\":12,\"swamp\":24}},\"ResourceValues\":{\"food\":10},\"ResourceTransporter\":{\"crossCreeks\":1.25,\"crossStreams\":2,\"moveOnLand\":true,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"canal\":3,\"stream\":6,\"river\":3,\"desert\":12,\"grass\":12,\"hill\":18,\"marsh\":18,\"moor\":12,\"mountain\":24,\"oceans\":12,\"swamp\":24}},\"goods\":{\"food\":{\"tile\":\"wheat\"}},\"terrains\":{\"desert\":{\"name\":\"Desert\",\"movementCost\":12,\"food\":0,\"tile\":\"desert\"},\"grass\":{\"name\":\"Grassland\",\"movementCost\":12,\"food\":1,\"tile\":\"grass\"},\"hill\":{\"name\":\"Hill\",\"movementCost\":12,\"food\":1,\"tile\":\"grass\"},\"lake\":{\"name\":\"Lake\",\"movementCost\":12,\"food\":1,\"isWater\":true,\"tile\":\"lake\"},\"marsh\":{\"name\":\"Marsh\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"},\"moor\":{\"name\":\"Moor\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"mountain\":{\"name\":\"Mountain\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"ocean\":{\"name\":\"Ocean\",\"movementCost\":12,\"food\":1,\"isWater\":true,\"tile\":\"ocean\"},\"swamp\":{\"name\":\"Swamp\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"}},\"laborers\":{\"farmer\":{\"name\":\"Farmer\"},\"miner\":{\"name\":\"Miner\"},\"rancher\":{\"name\":\"Rancher\"}},\"units\":{\"builder\":{\"name\":\"Builder\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"farmer\":{\"name\":\"Farmer\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"miner\":{\"name\":\"Miner\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"rancher\":{\"name\":\"Rancher\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"settler\":{\"name\":\"Settler\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}},\"warrior\":{\"name\":\"Warrior\",\"attack\":1,\"attackCities\":true,\"defense\":1,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"desert\":12,\"grass\":12,\"hill\":12,\"moor\":12,\"mountain\":24,\"swamp\":24}}},\"world\":[[{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"swamp\",\"river\":true},{\"terrain\":\"lake\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"lake\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"desert\"},{\"terrain\":\"desert\",\"river\":true},{\"terrain\":\"desert\"},{\"terrain\":\"grass\",\"city\":{\"nation\":0}},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}]]}");function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function dt(){dt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:P(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",y="suspendedYield",p="executing",v="completed",d={};function m(){}function b(){}function g(){}var w={};c(w,a,function(){return this});var k=Object.getPrototypeOf,x=k&&k(k(A([])));x&&x!==n&&r.call(x,a)&&(w=x);var O=g.prototype=m.prototype=Object.create(w);function S(t){["next","throw","return"].forEach(function(e){c(t,e,function(t){return this._invoke(e,t)})})}function T(t,e){function n(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==vt(l)&&r.call(l,"__await")?e.resolve(l.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(l).then(function(t){c.value=t,a(c)},function(t){return n("throw",t,a,s)})}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e(function(e,i){n(t,r,e,i)})}return o=o?o.then(i,i):i()}})}function P(e,n,r){var i=h;return function(o,a){if(i===p)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=E(s,r);if(u){if(u===d)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var c=f(e,n,r);if("normal"===c.type){if(i=r.done?v:y,c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function E(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,d;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(vt(e)+" is not iterable")}return b.prototype=g,i(O,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},S(T.prototype),c(T.prototype,s,function(){return this}),e.AsyncIterator=T,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new T(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},S(O),c(O,u,"Generator"),c(O,a,function(){return this}),c(O,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),M(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}var mt=dt().mark(Ft);function bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(n),!0).forEach(function(e){wt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function wt(t,e,n){return(e=xt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xt(r.key),r)}}function xt(t){var e=function(t){if("object"!=vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vt(e)?e:e+""}function Ot(t,e,n){St(t,e),e.set(t,n)}function St(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Tt(t,e){return t.get(Et(t,e))}function Pt(t,e,n){return t.set(Et(t,e),n),n}function Et(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function jt(t,e,n,r){if(!dr(t))throw new TypeError("FindPath expects a Hex as start!");if(!dr(e))throw new TypeError("FindPath expects a Hex as end!");if(!_t.isInstanceofMovable(n))throw new TypeError("FindPath expects a Movable!");var i=[],o=[],a=!1;t.parent=void 0,i.push(t),t.g_cost=0;for(var s=function(){var t=i.sort(function(t,e){return t.f_cost-e.f_cost||t.h_cost-e.h_cost})[0];if(t===e)return a=!0,1;i=i.filter(function(e){return t!==e}),o.push(t),r.traverse(tt({center:[t.q,t.r],radius:1})).forEach(function(a){o.includes(a)||br(a,n)&&(a.g_cost=t.g_cost+gr(n,a,t),a.h_cost=r.distance(t,e),a.f_cost=a.g_cost+a.h_cost,i.includes(a)||(a.parent=t,i.push(a)))})};i.length>0&&!s(););if(!a)return[];var u=[e],c=e;do{var l;(c=c.parent)!==t&&u.unshift(c)}while(dr(null===(l=c)||void 0===l?void 0:l.parent));return u}var Mt=new WeakMap,Ct=new WeakMap,At=new WeakMap,Wt=new WeakMap,It=new WeakMap,qt=new WeakMap,Lt=new WeakMap,Nt=new WeakSet,_t=function(){function t(e){var n=e.base,r=void 0===n?{}:n,i=e.hex,o=e.faction;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){St(t,e),e.add(t)}(this,Nt),Ot(this,Mt,pt.StandardMovable),Ot(this,Ct,!1),Ot(this,At,void 0),Ot(this,Wt,void 0),Ot(this,It,null),Ot(this,qt,0),Ot(this,Lt,[]),!dr(i))throw new TypeError("Movable expects to be assigned a Hex!");Pt(At,this,Qe.isFaction(o)?o:i.tile.faction),Pt(Wt,this,i),Pt(Mt,this,gt(gt(gt({},Tt(Mt,this)),r),{},{movementCosts:gt(gt({},Tt(Mt,this).movementCosts),r.movementCosts)}))}return e=t,n=[{key:"baseMovementPoints",get:function(){return Tt(Mt,this).movementPoints}},{key:"deleted",get:function(){return Tt(Ct,this)},set:function(t){Pt(Ct,this,!!t)}},{key:"faction",get:function(){return Tt(At,this)}},{key:"canContinueOnPath",get:function(){return null!==Tt(It,this)&&Tt(Lt,this).length>0&&Tt(qt,this)>0}},{key:"hex",get:function(){return Tt(Wt,this)}},{key:"movementCosts",get:function(){return Tt(Mt,this).movementCosts}},{key:"moveOnWater",get:function(){return Tt(Mt,this).moveOnWater||!1}},{key:"moves",get:function(){return Tt(qt,this)}},{key:"row",get:function(){return Tt(Wt,this).row}},{key:"col",get:function(){return Tt(Wt,this).col}},{key:"activate",value:function(){!0===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.canContinueOnPath?this.moveOneTurn():Pt(It,this,null)}},{key:"deactivate",value:function(){!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Pt(qt,this,0)}},{key:"destroy",value:function(){Pt(qt,this,0),Pt(Lt,this,[]),this.deleted=!0,Pt(It,this,null)}},{key:"prepareForNewTurn",value:function(){Pt(qt,this,Tt(Mt,this).movementPoints)}},{key:"setPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;if(!dr(t))throw new TypeError("Movable.setPath expects to be assigned a Hex!");var n=jt(Tt(Wt,this),t,this,e);return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;if(!Array.isArray(t)||0===t.length||t.some(function(t){return!dr(t)}))return!1;for(var n=1;n<t.length;n++){var r=t[n-1],i=t[n];if(1!==e.distance(r,i))return!1}return!0}(n,e)?(Pt(Lt,this,n),Pt(It,this,Et(Nt,this,Ft).call(this))):(console.warn("Sam, no path found!"),Pt(It,this,null))}},{key:"moveOneStep",value:function(){if(null!==Tt(It,this)){var t=Tt(It,this).next();Pt(Wt,this,t.value),(t.done||Tt(Lt,this).length<=0)&&Pt(It,this,null)}}},{key:"moveOneTurn",value:function(){for(;this.canContinueOnPath;)this.moveOneStep()}}],r=[{key:"isInstanceofMovable",value:function(e){return e instanceof t}},{key:"isActivatableMovable",value:function(e){return t.isInstanceofMovable(e)&&!1===e.deleted}},{key:"isMovableCanMove",value:function(e){return t.isActivatableMovable(e)&&e.moves>0}}],n&&kt(e.prototype,n),r&&kt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function Ft(){var t,e;return dt().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(Tt(Lt,this).length>0)){n.next=12;break}if(t=Tt(Lt,this)[0],e=gr(this,t),!(Tt(qt,this)<e)){n.next=6;break}return this.deactivate(!0),n.abrupt("break",12);case 6:return Pt(qt,this,Tt(qt,this)-e),Pt(Wt,this,t),n.next=10,Tt(Lt,this).shift();case 10:n.next=0;break;case 12:case"end":return n.stop()}},mt,this)}function Rt(t){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rt(t)}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ht(r.key),r)}}function Ht(t){var e=function(t){if("object"!=Rt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Rt(e)?e:e+""}function Dt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Dt=function(){return!!t})()}function Vt(t){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vt(t)}function Gt(t,e){return Gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gt(t,e)}function zt(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function Bt(t,e){return t.get(Yt(t,e))}function Kt(t,e,n){return t.set(Yt(t,e),n),n}function Yt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Jt=new WeakMap,Xt=new WeakMap,$t=new WeakMap,Qt=new WeakMap,Zt=function(t){function e(t,n){var r,i=n.hex,o=n.num,a=void 0===o?1:o;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!e.isValidGoodsType(t))throw new TypeError("Unknown Goods type '".concat(t,"'"));return zt(r=function(t,e,n){return e=Vt(e),function(t,e){if(e&&("object"==Rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Dt()?Reflect.construct(e,n||[],Vt(t).constructor):e.apply(t,n))}(this,e,[{base:pt.ResourceTransporter,hex:i}]),Jt,void 0),zt(r,Xt,void 0),zt(r,$t,0),zt(r,Qt,void 0),Kt(Jt,r,t),Kt(Xt,r,a),Kt(Qt,r,i),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gt(t,e)}(e,t),n=e,i=[{key:"isGoods",value:function(t){return t instanceof e}},{key:"isValidGoodsType",value:function(t){var e;return"object"===Rt(null!==(e=pt.goods[t])&&void 0!==e&&e)}}],(r=[{key:"goodsType",get:function(){return Bt(Jt,this)}},{key:"num",get:function(){return Bt(Xt,this)},set:function(t){if(!Number.isInteger(t)||t<0)throw new TypeError("Goods.num expects to be assigned a nonnegative integer!");Kt(Xt,this,t)}},{key:"rounds",get:function(){return Bt($t,this)},set:function(t){if(!Number.isInteger(t)||t<0)throw new TypeError("Goods.rounds expects to be assigned a nonnegative integer!");Kt($t,this,t)}},{key:"start",get:function(){return Bt(Qt,this)}}])&&Ut(n.prototype,r),i&&Ut(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(_t);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,re(r.key),r)}}function re(t){var e=function(t){if("object"!=te(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==te(e)?e:e+""}function ie(t){var e="function"==typeof Map?new Map:void 0;return ie=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(oe())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&ae(i,n.prototype),i}(t,arguments,se(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ae(n,t)},ie(t)}function oe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(oe=function(){return!!t})()}function ae(t,e){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ae(t,e)}function se(t){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},se(t)}var ue=[],ce=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,n){return e=se(e),function(t,e){if(e&&("object"==te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,oe()?Reflect.construct(e,n||[],se(t).constructor):e.apply(t,n))}(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ae(t,e)}(e,t),n=e,r=[{key:"on",value:function(t,e){this.addEventListener(t,e)}},{key:"off",value:function(t,e){this.removeEventListener(t,e)}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.dispatchEvent(new CustomEvent(t,{detail:e}))}}],r&&ne(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(ie(EventTarget)),le={events:new ce,players:[],turn:0,activeUnit:null,currentPlayer:null,intCurrentPlayer:null,graphics:{},startRound:function(){var t=this;this.players.forEach(function(t){t.units=t.units}),mr.forEach(function(e){if(t.nations.forEach(function(t){e.tile.nation===t?e.tile.claimTerritory(t,1):e.tile.claims(t)>0&&e.tile.claimTerritory(t,-1)}),t.players.forEach(function(t){e.tile.faction===t?e.tile.claimTerritory(t,1):e.tile.claims(t)>0&&e.tile.claimTerritory(t,-1)}),e.tile.food=0,e.tile.laborers.size>0){var n=0;if(n+=e.terrain.food||0,(n+=e.tile.improvement.food||0)>0){var r=new Zt("food",{num:n,hex:e});ue.push(r),t.events.emit("goods-created",{goods:r})}}}),mr.forEach(function(t){sr.isCity(t.city)&&(t.city,mr.traverse(nt({start:[t.q,t.r],radius:2})).forEach(function(t){}))}),this.turn++,this.startTurn(0)},startTurn:function(t){if(!Number.isFinite(t))throw new TypeError("Unknown player ".concat(t));if(this.currentPlayer=this.players[t],!(this.currentPlayer instanceof Qe))throw new TypeError("Player ".concat(t," is not a Faction Object"));this.intCurrentPlayer=t,this.currentPlayer.units.forEach(function(t){t.prepareForNewTurn()}),this.currentPlayer.activateUnit(0)},markTerritory:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.graphics,r=void 0===n?this.graphics.territoryLines:n,i=e.lineOffset,o=void 0===i?.97:i,a=e.offsetX,s=void 0===a?0:a,u=e.offsetY,c=void 0===u?0:u,l=e.fill,f=void 0!==l&&l,h=e.lineWidth,y=void 0===h?5:h;(dr(t)?[t]:mr).forEach(function(t){if(Cn.isTile(t.tile)&&t.tile.faction instanceof Qe){!1===f?r.lineStyle(y,t.tile.faction.color):r.fillStyle(t.tile.faction.color),r.beginPath();var e=function(t){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ee(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.corners.map(function(e){return yt(e,t,o)})),n=e[0],i=e.slice(1);r.moveTo(n.x+s,n.y+c),i.forEach(function(t){var e=t.x,n=t.y;r.lineTo(e+s,n+c)}),r.closePath()[!1===f?"strokePath":"fillPath"]()}})},endTurn:function(){this.intCurrentPlayer++,this.intCurrentPlayer>=this.players.length?this.endRound():this.startTurn(this.intCurrentPlayer)},endRound:function(){var t=this;this.betweenRounds=!0;var e=[];mr.forEach(function(t){sr.isCity(t.city)&&e.push(t)}),ue.forEach(function(t,n){t.faction;var r=t.hex,i=t.num,o=t.goodsType;if("food"===o)if(i<=0)t.destroy();else{if(r.tile.laborers.size>0&&r.tile.food<r.tile.laborers.size*zn.FOOD_CONSUMPTION){var a=Math.max(0,r.tile.laborers.size*zn.FOOD_CONSUMPTION-r.tile.food),s=Math.min(a,i);if(t.num=i-=s,r.tile.food+=s,i<=0)return void t.destroy()}var u=null,c=1/0;e.forEach(function(t){var e=mr.distance(r,t);e<c&&(u=t,c=e)}),dr(u)&&sr.isCity(u.city)&&null!==t.setPath(u)&&(t.prepareForNewTurn(),t.moveOneTurn()),"food"===o&&++t.rounds>5&&t.destroy()}}),mr.forEach(function(t){t.tile.laborers.size>0&&(t.tile.food,t.tile.laborers.size,zn.FOOD_CONSUMPTION),t.tile.food-=t.tile.laborers.size*zn.FOOD_CONSUMPTION}),Promise.all([]).then(function(){t.betweenRounds=!1,t.startRound()})}};function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function he(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ye(r.key),r)}}function ye(t){var e=function(t){if("object"!=fe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fe(e)?e:e+""}function pe(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function ve(t,e){return t.get(me(t,e))}function de(t,e,n){return t.set(me(t,e),n),n}function me(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}le.events.on("end-turn",le.endTurn.bind(le));var be=new Map,ge=new WeakMap,we=new WeakMap,ke=new WeakMap,xe=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),pe(this,ge,void 0),pe(this,we,void 0),pe(this,ke,void 0),de(ge,this,{x:e.hex.x,y:e.hex.y}),de(we,this,n),de(ke,this,n.add.sprite(ve(ge,this).x,ve(ge,this).y,"unit.".concat(e.unitType)).setTint(3684408).setDepth(11)),ve(ke,this).setScale(80/ve(ke,this).width)},(e=[{key:"scene",get:function(){return ve(we,this)}},{key:"sprite",get:function(){return ve(ke,this)}},{key:"x",get:function(){return ve(ge,this).x}},{key:"y",get:function(){return ve(ge,this).y}},{key:"update",value:function(t){ve(ge,this).x=t.x,ve(ge,this).y=t.y}}])&&he(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Oe(t){if(be.has(t)){var e=be.get(t);e.sprite.setVisible(!1),e.sprite.destroy(),be.delete(t)}}function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function Te(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Pe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ee(r.key),r)}}function Ee(t){var e=function(t){if("object"!=Se(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Se(e)?e:e+""}function je(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(je=function(){return!!t})()}function Me(t,e,n,r){var i=Ce(Ae(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof i?function(t){return i.apply(n,t)}:i}function Ce(){return Ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ae(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Ce.apply(null,arguments)}function Ae(t){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ae(t)}function We(t,e){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},We(t,e)}function Ie(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function qe(t,e,n){switch(t){case"u":n%2==0&&e--,n--;break;case"i":e--;break;case"o":n%2==0&&e--,n++;break;case"j":n%2==1&&e++,n--;break;case"k":e++;break;case"l":n%2==1&&e++,n++;break;default:throw new TypeError("Unknown action tile '".concat(t,"'"))}return[e,n]}var Le=new WeakMap,Ne=function(t){function e(t,n){var r,i,o=n.hex,a=n.faction;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!Qe.isFaction(a))throw new TypeError("Unit expects to be assigned a Faction!");return function(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}(i=function(t,e,n){return e=Ae(e),function(t,e){if(e&&("object"==Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,je()?Reflect.construct(e,n||[],Ae(t).constructor):e.apply(t,n))}(this,e,[{base:null!==(r=pt.units[t])&&void 0!==r?r:function(t){throw new TypeError(t)}("Unknown unit '".concat(t,"'")),hex:o,faction:a}]),Le,void 0),function(t,e,n){t.set(Ie(t,e),n)}(Le,i,t),le.events.emit("unit-created",{unit:i}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&We(t,e)}(e,t),n=e,r=[{key:"unitType",get:function(){return function(t,e){return t.get(Ie(t,e))}(Le,this)}},{key:"deactivate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Me(e,"deactivate",this,3)([t]),le.activeUnit=null,le.events.emit("unit-deactivated",{unit:this}),this.faction.checkEndTurn()}},{key:"activate",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Me(e,"activate",this,3)([t]),le.activeUnit=this,0===this.faction.index?le.events.emit("unit-activated",{unit:this}):this.deactivate(!0)}},{key:"destroy",value:function(){this.deactivate(!0),Me(e,"destroy",this,3)([]),Oe(this)}},{key:"doAction",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mr;try{var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Te(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Te(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(qe(t,this.row,this.col),2),i=r[0],o=r[1],a=n.getHex({row:i,col:o});Me(e,"setPath",this,3)([a,n]),Me(e,"moveOneStep",this,3)([])}catch(t){}}}],i=[{key:"isUnit",value:function(t){return t instanceof e}},{key:"isActivatableUnit",value:function(t){return e.isUnit(t)&&!1===t.deleted}},{key:"isMovableUnit",value:function(t){return e.isActivatableUnit(t)&&t.moves>0}}],r&&Pe(n.prototype,r),i&&Pe(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(_t);function _e(t){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(t)}function Fe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Re(r.key),r)}}function Re(t){var e=function(t){if("object"!=_e(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_e(e)?e:e+""}function Ue(t,e,n){He(t,e),e.set(t,n)}function He(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function De(t,e){return t.get(Ge(t,e))}function Ve(t,e,n){return t.set(Ge(t,e),n),n}function Ge(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}Ne.isUnit;var ze=new WeakMap,Be=new WeakMap,Ke=new WeakMap,Ye=new WeakMap,Je=new WeakMap,Xe=new WeakMap,$e=new WeakSet,Qe=function(){function t(e){var n=e.index;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){He(t,e),e.add(t)}(this,$e),Ue(this,ze,null),Ue(this,Be,void 0),Ue(this,Ke,void 0),Ue(this,Ye,0),Ue(this,Je,void 0),Ue(this,Xe,[]),Ve(Ke,this,n),Ve(Be,this,function(t){var e;return null!==(e=[3329330,16711680,255][t])&&void 0!==e?e:11184810}(n)),Ve(Je,this,null==pt?void 0:pt.FactionNames[n]),Ge($e,this,Ze).call(this)}return e=t,n=[{key:"activeUnit",get:function(){if(Number.isInteger(De(ze,this))&&De(ze,this)>=0&&De(ze,this)<=De(Xe,this).length)return De(Xe,this)[De(ze,this)]},set:function(t){Number.isInteger(t)&&t>=0?Ve(ze,this,t%De(Xe,this).length):null===t&&Ve(ze,this,null)}},{key:"color",get:function(){return De(Be,this)}},{key:"index",get:function(){return De(Ke,this)}},{key:"money",get:function(){return De(Ye,this)},set:function(t){if(!Number.isFinite(t)||t<0)throw new TypeError("Faction.money expects to be assigned a positive number!");Ve(Ye,this,t)}},{key:"name",get:function(){return De(Je,this)}},{key:"nation",get:function(){return le.nations[0]}},{key:"units",get:function(){return De(Xe,this)},set:function(t){if(!Array.isArray(t))throw new TypeError("Faction.units expects to be assigned an Array!");Ve(Xe,this,t.filter(Ne.isActivatableUnit))}},{key:"addUnit",value:function(t,e){De(Xe,this).push(new Ne(t,{hex:e,faction:this}))}},{key:"checkEndTurn",value:function(){this.activateNext()||le.events.emit("end-turn",{faction:this})}},{key:"activateUnit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:De(ze,this);return 0===De(Xe,this).length?(le.events.emit("end-turn",{faction:this}),!1):!!Ne.isActivatableUnit(De(Xe,this)[t])&&(De(Xe,this)[t].activate(),Ve(ze,this,t),!0)}},{key:"activateNext",value:function(){var t=function(t,e){for(var n=0;n<t.length;n++){var r=(e+1+n)%t.length;if(Ne.isMovableUnit(t[r]))return t[r]}return!1}(De(Xe,this),De(ze,this));return!!Ne.isMovableUnit(t)&&(Ve(ze,this,De(Xe,this).indexOf(t)),t.activate(),!0)}}],r=[{key:"isFaction",value:function(e){return e instanceof t}}],n&&Fe(e.prototype,n),r&&Fe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function Ze(){var t=this;le.events.on("goods-moved",function(e){var n=e.detail,r=n.goods,i=n.promise;r.faction===t&&sr.isCity(r.hex.city)&&i.then(function(){Ve(Ye,t,De(Ye,t)+pt.ResourceValues[r.goodsType]*r.num),r.destroy()})}),le.events.on("unit-moved",function(e){e.detail.faction!==t&&e.detail.unit.faction!==t||e.detail.promise.then(function(){return t.checkEndTurn()})})}function tn(t){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tn(t)}function en(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nn(r.key),r)}}function nn(t){var e=function(t){if("object"!=tn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tn(e)?e:e+""}function rn(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function on(t,e){return t.get(sn(t,e))}function an(t,e,n){return t.set(sn(t,e),n),n}function sn(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var un=new WeakMap,cn=new WeakMap,ln=new WeakMap,fn=new WeakMap,hn=function(){function t(e){var n,r,i,o=e.index;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),rn(this,un,void 0),rn(this,cn,void 0),rn(this,ln,void 0),rn(this,fn,void 0),an(ln,this,o),an(un,this,null!==(n=[3329330,16711680,255][o])&&void 0!==n?n:11184810),an(cn,this,(o+1)%3),an(fn,this,null!==(r=null===(i=pt.NationNames)||void 0===i?void 0:i[o])&&void 0!==r?r:"Unknown")}return e=t,r=[{key:"isNation",value:function(e){return e instanceof t}}],(n=[{key:"color",get:function(){return on(un,this)}},{key:"frame",get:function(){return on(cn,this)}},{key:"index",get:function(){return on(ln,this)}},{key:"name",get:function(){return on(fn,this)}}])&&en(e.prototype,n),r&&en(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function yn(t){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yn(t)}function pn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function vn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pn(Object(n),!0).forEach(function(e){dn(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function dn(t,e,n){return(e=bn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bn(r.key),r)}}function bn(t){var e=function(t){if("object"!=yn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yn(e)?e:e+""}function gn(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function wn(t,e){return t.get(xn(t,e))}function kn(t,e,n){return t.set(xn(t,e),n),n}function xn(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function On(t,e,n){var r;return!!dr(t)&&"string"==typeof e&&""!==e&&e in pt.improvements&&(""===n.key||n.key===e)&&t.terrain.terrain in(null===(r=pt.improvements[e])||void 0===r?void 0:r.terrains)&&!sr.isCity(t.city)}var Sn=new WeakMap,Tn=new WeakMap,Pn=new WeakMap,En=new WeakMap,jn=new WeakMap,Mn=new WeakMap,Cn=function(){function t(e){var n=e.hex;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gn(this,Sn,{faction:new Map,nation:new Map}),gn(this,Tn,void 0),gn(this,Pn,void 0),gn(this,En,{key:""}),gn(this,jn,new Set),gn(this,Mn,0),!dr(n))throw new TypeError("Tile expects to be assigned object instance of Hex!");kn(Tn,this,n)}return e=t,n=[{key:"faction",get:function(){var t={faction:null,claim:0};return wn(Sn,this).faction.forEach(function(e,n){t.claim<e&&(t.faction=n,t.claim=e)}),t.faction}},{key:"hex",get:function(){return wn(Tn,this)}},{key:"improvement",get:function(){return wn(Pn,this)||{}}},{key:"laborers",get:function(){return wn(jn,this)},set:function(t){if(!zn.isLaborer(t))throw new TypeError("Tile.laborers expects to be assigned object instance of Laborer!");wn(jn,this).add(t)}},{key:"nation",get:function(){var t={nation:null,claim:0};return wn(Sn,this).nation.forEach(function(e,n){t.claim<e&&(t.nation=n,t.claim=e)}),t.nation}},{key:"claims",value:function(t,e){var n=null;return Qe.isFaction(t)?n="faction":hn.isNation(t)&&(n="nation"),n in wn(Sn,this)?(Number.isInteger(e)&&0!==e&&wn(Sn,this)[n].set(t,(wn(Sn,this)[n].get(t)||0)+e),wn(Sn,this)[n].get(t)||0):wn(Sn,this)}},{key:"claimTerritory",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Number.isFinite(e)&&0!==e){var n,r=void 0;hn.isNation(t)&&hn.isNation(this.nation)?r=this.nation.index:Qe.isFaction(t)&&Qe.isFaction(this.faction)&&(r=this.faction.index),this.claims(t,e),Qe.isFaction(t)&&(null===(n=this.faction)||void 0===n?void 0:n.index)!==r&&(le.markTerritory(this.hex,{graphics:le.graphics.territoryFills,lineOffset:1,fill:!0}),le.markTerritory(this.hex,{graphics:le.graphics.territoryLines,lineOffset:.97,fill:!1}))}}},{key:"isValidImprovement",value:function(t){return On(wn(Tn,this),t,wn(En,this))}},{key:"setImprovement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"destroy"===t?(kn(Pn,this,void 0),kn(En,this,{key:""}),!0):!!On(wn(Tn,this),t,wn(En,this))&&(kn(Pn,this,vn(vn(vn({},pt.improvements[t]),pt.improvements[t].terrains[wn(Tn,this).terrain.terrain]),{},{key:t})),e instanceof Qe&&(this.claimTerritory(e,10),wn(Pn,this).faction=e),wn(En,this).key=t,!0)}}],r=[{key:"isTile",value:function(e){return e instanceof t}}],n&&mn(e.prototype,n),r&&mn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function An(t){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},An(t)}function Wn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qn(r.key),r)}}function In(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function qn(t){var e=function(t){if("object"!=An(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=An(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==An(e)?e:e+""}function Ln(t,e){return t.get(_n(t,e))}function Nn(t,e,n){return t.set(_n(t,e),n),n}function _n(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Fn,Rn,Un=new WeakMap,Hn=new WeakMap,Dn=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,zn=function(){function t(){var e,n,r,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=u.city,l=(u.faction,u.hex),f=u.tile,h=u.type;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),In(this,Un,void 0),In(this,Hn,void 0),In(this,Dn,void 0),In(this,Vn,void 0),In(this,Gn,void 0),Nn(Dn,this,(e=["Gaius","Lucius","Marcus","Quintus","Titus","Publius","Aulus","Sextus"],n=["Bran","Cai","Elen","Rhiannon","Taran","Mabon","Nia","Owain"],r=["Agricola","Felix","Silvanus","Varus","Florus","Crispus","Severus","Vitalis"],i=["the Smith","of Londinium","the Younger","the Red","from Camulodunum","the Hunter"],o=Math.random()<.5?e[Math.floor(Math.random()*e.length)]:n[Math.floor(Math.random()*n.length)],a=r[Math.floor(Math.random()*r.length)],s=Math.random()<.3?i[Math.floor(Math.random()*i.length)]:"","".concat(o," ").concat(a," ").concat(s).trim())),Nn(Gn,this,h),sr.isCity(c)&&Nn(Un,this,c),(dr(l)||dr(null==f?void 0:f.hex))&&Nn(Hn,this,l||(null==f?void 0:f.hex)),(Cn.isTile(f)||Cn.isTile(null==l?void 0:l.tile))&&Nn(Vn,this,f||(null==l?void 0:l.tile))}return e=t,r=[{key:"isLaborer",value:function(e){return e instanceof t}}],(n=[{key:"city",get:function(){return Ln(Un,this)}},{key:"hex",get:function(){return Ln(Hn,this)}},{key:"name",get:function(){return Ln(Dn,this)}},{key:"tile",get:function(){return Ln(Vn,this)},set:function(t){if(!Cn.isTile(t))throw new TypeError("Laborer.tile expects to be assigned object instance of Tile!");Nn(Vn,this,t)}},{key:"type",get:function(){return Ln(Gn,this)}},{key:"assignTile",value:function(t){if(!Cn.isTile(t))throw new TypeError("Laborer.assignTile expects to be passed object instance of Tile!");this.tile=t}}])&&Wn(e.prototype,n),r&&Wn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function Bn(t){return Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bn(t)}function Kn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yn(r.key),r)}}function Yn(t){var e=function(t){if("object"!=Bn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Bn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Bn(e)?e:e+""}function Jn(t,e,n){Xn(t,e),e.set(t,n)}function Xn(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function $n(t,e){return t.get(Zn(t,e))}function Qn(t,e,n){return t.set(Zn(t,e),n),n}function Zn(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}Fn=zn,(Rn=qn(Rn="FOOD_CONSUMPTION"))in Fn?Object.defineProperty(Fn,Rn,{value:2,enumerable:!0,configurable:!0,writable:!0}):Fn[Rn]=2;var tr=new WeakMap,er=new WeakMap,nr=new WeakMap,rr=new WeakMap,ir=new WeakMap,or=new WeakMap,ar=new WeakSet,sr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.col,r=e.row,i=e.level,o=void 0===i?1:i,a=e.nation;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Xn(t,e),e.add(t)}(this,ar),Jn(this,tr,void 0),Jn(this,er,new Set),Jn(this,nr,void 0),Jn(this,rr,void 0),Jn(this,ir,[]),Jn(this,or,void 0),!hn.isNation(a))throw new TypeError("City expects to be assigned a Nation!");var s=le.scenes.getScene("mainGameScene"),u=mr.getHex({row:r,col:n});u.tile.setImprovement("destroy"),Qn(tr,this,u),Qn(nr,this,o),Qn(rr,this,a),Qn(or,this,s.add.image(u.x,u.y,"cities",a.frame).setDepth(10).setScale(.8)),u.city=this,Zn(ar,this,ur).call(this)}return function(t,e,n){return e&&Kn(t.prototype,e),n&&Kn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(t,[{key:"hex",get:function(){return $n(tr,this)}},{key:"laborers",get:function(){return $n(er,this)},set:function(t){if(!(t instanceof zn))throw new TypeError("City.laborers expects to be assigned object instance of Laborer!");$n(er,this).add(t)}},{key:"level",get:function(){return $n(nr,this)}},{key:"nation",get:function(){return $n(rr,this)}},{key:"queue",get:function(){return $n(ir,this)}},{key:"sprite",get:function(){return $n(or,this)}},{key:"addToQueue",value:function(t){var e=t.faction,n=t.unitType;n in pt.units?$n(ir,this).push({unitType:n,faction:e}):console.warn("City production queue: Unknown unit key ".concat(n))}}],[{key:"isCity",value:function(e){return e instanceof t}}])}();function ur(){var t=this;mr.traverse(nt({start:[$n(tr,this).q,$n(tr,this).r],radius:1})).forEach(function(e){e.tile.claimTerritory($n(rr,t),100)}),mr.traverse(tt({center:[$n(tr,this).q,$n(tr,this).r],radius:2})).forEach(function(e){e.terrain.isWater&&e.tile.claimTerritory($n(rr,t),50)})}function cr(t){return cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cr(t)}function lr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(lr=function(){return!!t})()}function fr(t){return fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fr(t)}function hr(t,e){return hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hr(t,e)}function yr(t,e,n){return(e=pr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pr(t){var e=function(t){if("object"!=cr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=cr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cr(e)?e:e+""}var vr=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return yr(t=function(t,e,n){return e=fr(e),function(t,e){if(e&&("object"==cr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,lr()?Reflect.construct(e,n||[],fr(t).constructor):e.apply(t,n))}(this,e,[].concat(r)),"f_cost",void 0),yr(t,"h_cost",void 0),yr(t,"g_cost",void 0),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hr(t,e)}(e,t),function(t){return Object.defineProperty(t,"prototype",{writable:!1}),t}(e)}(I({dimensions:100,orientation:j.FLAT,origin:"topLeft"}));function dr(t){return t instanceof M}var mr=new at(vr,$({width:15,height:6}));function br(t,e){if(!dr(t))return!1;if(!_t.isInstanceofMovable(e))return!1;if(Ne.isUnit(e)){if(sr.isCity(t.city)&&t.city.nation!==e.faction.nation&&(!e.attack||!e.attackCities))return!1}else Zt.isGoods(e);var n=gr(e,t);return!!Number.isFinite(n)&&n<=e.baseMovementPoints}function gr(t,e){var n,r,i;return arguments.length>2&&void 0!==arguments[2]||t.hex,dr(e)&&_t.isInstanceofMovable(t)?e.terrain.isWater&&!t.moveOnWater?null!==(i=t.movementCosts[e.terrain.terrain])&&void 0!==i?i:1/0:null!==(n=null!==(r=t.movementCosts[e.terrain.terrain])&&void 0!==r?r:e.terrain.movementCost)&&void 0!==n?n:1/0:1/0}function wr(t){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wr(t)}function kr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function xr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Or(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tr(r.key),r)}}function Sr(t,e,n){return e&&Or(t.prototype,e),n&&Or(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tr(t){var e=function(t){if("object"!=wr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wr(e)?e:e+""}function Pr(t,e,n){Er(t,e),e.set(t,n)}function Er(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function jr(t,e){return t.get(Mr(t,e))}function Mr(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Cr=new WeakMap,Ar=new WeakMap,Wr=new WeakMap,Ir=function(){return Sr(function t(e){var n=this;xr(this,t),Pr(this,Cr,void 0),Pr(this,Ar,void 0),Pr(this,Wr,void 0),["execute","isValid","label"].forEach(function(t){t in e&&(n["#".concat(t)]=e[t],delete e[t])}),Object.assign(this,e)},[{key:"isValid",value:function(t){var e;if("string"==typeof t.menu&&(null===(e=this.showIn)||void 0===e||!e.includes(t.menu)))return!1;if(!0===jr(Ar,this))return!0;if(Array.isArray(this.unitTypes)&&(!Ne.isUnit(t.unit)||!this.unitTypes.includes(t.unit.unitType)))return!1;var n=Hr[jr(Ar,this)];return"function"!=typeof n||n(t)}},{key:"execute",value:function(t){var e=Dr[jr(Cr,this)];return!!this.isValid(t)&&("function"==typeof e?Promise.resolve().then(function(){le.events.emit("doing-action")}).then(function(){e(t)}):void console.warn("No executor for action ".concat(this.key)))}},{key:"label",get:function(){var t=Vr[jr(Wr,this)];return"function"==typeof t?t():jr(Wr,this)}}])}(),qr=new Map,Lr=new WeakSet,Nr=function(){function t(){if(xr(this,t),function(t,e){Er(t,e),e.add(t)}(this,Lr),Rr._)return Rr._;Rr._=this,Mr(Lr,this,_r).call(this),Mr(Lr,this,Fr).call(this)}return Sr(t,[{key:"handle",value:function(t,e){var n=qr.get(t);return n instanceof Ir&&!!n.isValid(e)&&(n.execute(e),!0)}},{key:"getAvailableActions",value:function(t){return function(t){return function(t){if(Array.isArray(t))return kr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return kr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kr(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(qr.values()).filter(function(e){return e.isValid(t)})}}],[{key:"getInstance",value:function(){return Rr._||new t,Rr._}}])}();function _r(){var t;null===(t=pt.actions)||void 0===t||t.forEach(function(t){var e=new Ir(t);qr.set(e.key,e)})}function Fr(){var t=this;le.events.on("key-pressed",function(e){var n=e.detail,r=le.activeUnit;if(Ne.isUnit(r)){var i={unit:r,hex:r.hex,faction:r.faction};t.handle(n,i)}})}var Rr={_:void 0},Ur=function(){return Sr(function t(){xr(this,t)},null,[{key:"handle",value:function(t,e){return Nr.getInstance().handle(t,e)}},{key:"getAvailableActions",value:function(t){return Nr.getInstance().getAvailableActions(t)}}])}();new Nr;var Hr={currentPlayerTurn:function(){return le.currentPlayer===le.players[0]},hexTileValid:function(t){var e=t.hex;return dr(e)&&Cn.isTile(e.tile)},isCityTile:function(t){var e=t.hex;return sr.isCity(e.city)},isFarmBuildable:function(t){var e=t.hex,n=t.unit;return e===n.hex&&!!Hr.hexTileValid({hex:e})&&"farmer"===n.unitType&&e.tile.isValidImprovement("farm")},isHexControlled:function(t){var e=t.hex,n=t.faction;return e.tile.faction===n},isLegalMove:function(t){var e=t.hex,n=t.unit;return e!==n.hex&&br(e,n)}},Dr={buildFarm:function(t){var e=t.unit,n=t.hex;n.tile.setImprovement("farm",e.faction),n.tile.laborers=new zn({hex:n,faction:e.faction,type:"farmer"}),e.destroy()},endTurn:function(){le.events.emit("end-turn")},skip:function(t){t.unit.deactivate(!0)},startCityView:function(t){var e=t.hex;le.scenes.start("city-view",{hex:e})},startMoveTo:function(t){var e=t.unit,n=t.hex;e.setPath(n)&&e.moveOneTurn()},startTileView:function(t){var e=t.hex;le.scenes.start("tile-view",{hex:e})},wait:function(t){t.unit.deactivate()}},Vr={};function Gr(t){return Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gr(t)}function zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Br(r.key),r)}}function Br(t){var e=function(t){if("object"!=Gr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Gr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Gr(e)?e:e+""}function Kr(t,e,n){Yr(t,e),e.set(t,n)}function Yr(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Jr(t,e){return t.get($r(t,e))}function Xr(t,e,n){return t.set($r(t,e),n),n}function $r(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var Qr=new WeakMap,Zr=new WeakMap,ti=new WeakMap,ei=new WeakMap,ni=new WeakSet,ri=function(){return function(t,e){return e&&zr(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){Yr(t,e),e.add(t)}(this,ni),Kr(this,Qr,void 0),Kr(this,Zr,void 0),Kr(this,ti,void 0),Kr(this,ei,void 0),!(e instanceof globalThis.Phaser.Scene))throw new Error("InputManager requires a Phaser.Scene instance");switch(Xr(Zr,this,e),Xr(ei,this,e.input.keyboard.addKey(globalThis.Phaser.Input.Keyboard.KeyCodes.SHIFT)),Xr(ti,this,Jr(Zr,this).scene.key)){case"city-view":$r(ni,this,ii).call(this);break;case"tile-view":$r(ni,this,oi).call(this);break;case"mainGameScene":$r(ni,this,ai).call(this)}},[{key:"disableKeyboardInput",value:function(){var t,e=null===(t=Jr(Zr,this).input)||void 0===t?void 0:t.keyboard;"object"===Gr(null!=e&&e)&&(e.enabled=!1,e.removeCapture("SPACE"),e.removeCapture("UP"),e.removeCapture("DOWN"),e.removeCapture("LEFT"),e.removeCapture("RIGHT"))}},{key:"enableKeyboardInput",value:function(){var t,e=null===(t=Jr(Zr,this).input)||void 0===t?void 0:t.keyboard;"object"===Gr(null!=e&&e)&&(e.enabled=!0,"mainGameScene"===Jr(ti,this))&&Xr(Qr,this,e.createCursorKeys())}},{key:"update",value:function(){if("mainGameScene"===Jr(ti,this)){var t=Jr(Zr,this).cameras.main,e=Jr(ei,this).isDown?25:5;Jr(Qr,this).left.isDown?t.scrollX-=e:Jr(Qr,this).right.isDown&&(t.scrollX+=e),Jr(Qr,this).up.isDown?t.scrollY-=e:Jr(Qr,this).down.isDown&&(t.scrollY+=e)}}},{key:"destroy",value:function(){}}])}();function ii(){var t=this;Jr(Zr,this).input.keyboard.on("keydown",function(e){"Escape"===e.key&&Jr(Zr,t).scene.stop("city-view")})}function oi(){var t=this;document.querySelector("#tile-view").addEventListener("contextmenu",function(t){t.preventDefault()}),Jr(Zr,this).input.keyboard.on("keydown",function(e){"Escape"===e.key&&Jr(Zr,t).scene.stop("tile-view")}),this.enableKeyboardInput()}function ai(){var t=this;le.domContainer.addEventListener("contextmenu",function(t){t.preventDefault()}),Jr(Zr,this).input.manager.canvas.addEventListener("contextmenu",function(t){t.preventDefault()}),Jr(Zr,this).input.keyboard.on("keydown",function(t){if(!(t.ctrlKey&&["r","R","1","2","3","4","5","6","7","8","9"].includes(t.key)||t.ctrlKey&&"I"===t.key)){switch(t.preventDefault(),t.key){case"q":case"e":case"r":case"t":case"y":case"u":case"i":case"o":case"p":case"a":case"d":case"f":case"g":case"h":case"j":case"k":case"l":case"z":case"x":case"c":case"v":case"b":case"n":case"m":case"F1":case"F2":case"F4":case"F5":case"F3":break;case"w":return void le.events.emit("key-pressed","wait");case"s":return void le.events.emit("key-pressed","skip");case"F":le.events.emit("key-pressed","build-farm");break;case"Escape":le.events.emit("esc-pressed")}if(["u","i","o","j","k","l"].includes(t.key)){if(!Ne.isMovableUnit(le.activeUnit))return;le.activeUnit.doAction(t.key)}}});var e=!1,n={x:0,y:0},r={x:0,y:0},i=4;Jr(Zr,this).input.on("pointerdown",function(o){switch(n.x=o.x,n.y=o.y,r.x=Jr(Zr,t).cameras.main.scrollX,r.y=Jr(Zr,t).cameras.main.scrollY,e=!1,o.pointerType){case"touch":i=10;break;case"pen":i=8;break;default:i=4}}),Jr(Zr,this).input.on("pointermove",function(o){if(o.isDown){var a=o.x-n.x,s=o.y-n.y;if(!e&&(Math.abs(a)>i||Math.abs(s)>i)&&(e=!0),e){var u=Jr(Zr,t).cameras.main.zoom||1;Jr(Zr,t).cameras.main.setScroll(r.x-a/u,r.y-s/u)}}}),Jr(Zr,this).input.on("pointerup",function(t){if(!e){var n=mr.pointToHex({x:t.worldX,y:t.worldY});dr(n)&&le.events.emit("hex-clicked",{hex:n})}e=!1}),this.enableKeyboardInput()}var si=null,ui=null;function ci(){ui&&(ui.setAttribute("hidden","true"),ui.innerHTML="")}const li={key:"city-view",preload:function(){},create:function(t){var e=this;if(dr(t.hex)&&Cn.isTile(t.hex.tile)&&sr.isCity(t.hex.city)){this.scene.pause("mainGameScene"),this.scene.moveAbove("mainControls","city-view");var n=ht();si=t.hex.city,null!=ui||(ui=document.getElementById("production-queue")),ui.innerHTML="";var r=document.createElement("select"),i=document.createElement("option");i.text="-- Select Unit Type --",i.value="",r.appendChild(i),Object.keys(pt.units).forEach(function(t){var e=document.createElement("option");e.value=t,e.text=pt.units[t].name,r.appendChild(e)}),ui.appendChild(r);var o=document.createElement("button");o.innerText="Add to Queue",o.addEventListener("click",function(){si.addToQueue({faction:le.currentPlayer,unitType:r.options[r.selectedIndex].value})}),o.disabled=!0,ui.appendChild(o),r.addEventListener("change",function(){o.disabled=""===r.options[r.selectedIndex].value}),ui.appendChild(document.createElement("ul")),ui.removeAttribute("hidden"),ui.style.zIndex=1;var a=this.add.graphics({x:0,y:0}).setDepth(0);a.fillStyle(0,.5),a.fillRect(0,0,n.width,n.height);var s=this.add.graphics({x:0,y:0}).setDepth(1);s.fillStyle(0,1),s.fillRect(n.width-100,0,100,100),this.add.text(n.width-100,0,"\xD7 ",{fixedWidth:100,fixedHeight:100,font:"60pt Trebuchet MS",align:"right",color:"white",stroke:"black",strokeThickness:7}).setDepth(2).setInteractive().on("pointerdown",function(){e.scene.stop("city-view")});var u=[t.hex.x,t.hex.y],c=u[0],l=u[1],f=Math.min(n.height,n.width)/7/ft,h=n.width/2,y=n.height/3;mr.traverse(nt({start:[t.hex.q,t.hex.r],radius:2})).forEach(function(t){var n={x:(t.x-c)*f+h,y:(t.y-l)*f+y},r=e.add.image(n.x,n.y,"tile.".concat(t.terrain.terrain)).setDepth(1);if(r.scaleX=f,r.scaleY=f,le.markTerritory(t,{offsetX:0-t.x+h+(t.x-c)*f,offsetY:0-t.y+y+(t.y-l)*f,graphics:s.setDepth(2),lineOffset:.95*f}),t.tile.laborers.size>0){var i=ft*f;e.add.text(n.x-i/2,n.y+i/4,"Food: ".concat((t.terrain.food||0)+(t.tile.improvement.food||0)),{font:"14pt Trebuchet MS",align:"center",color:"white",stroke:"black",strokeThickness:7,fixedWidth:i}).setDepth(3)}}),this.inputManager=new ri(this),this.events.on("sleep",function(){ci(),e.scene.wake("mainGameScene")}).on("shutdown",function(){ci(),e.scene.wake("mainGameScene")})}else this.scene.resume("mainGameScene")},update:function(){if(si){var t=document.querySelector("#production-queue > ul");t&&t.querySelectorAll("li").length!==si.queue.length&&(t.innerHTML="",si.queue.forEach(function(e){var n=e.faction,r=e.unitType,i=document.createElement("li");i.innerText="".concat(n.name,": ").concat(pt.units[r].name),t.appendChild(i)}))}}};var fi="mainControls",hi=new Map,yi=new Map;const pi={key:fi,autoStart:!0,preload:function(){this.load.image("coins","img/resources/coins.png")},create:function(){var t=le.graphics.mainControls=this.add.graphics({x:0,y:0}),e=15;hi.set("round",this.add.text(14,e,"Round ".concat(le.turn),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"white",stroke:"black",strokeThickness:5,maxLines:1})),hi.set("faction",this.add.text(14+hi.get("round").displayWidth+10,e+2,"",{fontFamily:"Trebuchet MS",fontSize:"26px",color:"white",stroke:"black",strokeThickness:5,maxLines:1})),e+=hi.get("faction").displayHeight+5,e-=15;var n=this.add.image(0,e,"coins").setDepth(2);n.setScale(32/n.width),n.x=20+n.displayWidth/2,n.y=e+=20+n.displayHeight/2,hi.set("money",this.add.text(n.x+n.displayWidth/2+6,n.y-n.displayHeight/2-4,le.players[0].money.toLocaleString("en-Us"),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"gold",stroke:"black",strokeThickness:5,maxLines:1}).setLetterSpacing(1)),yi.set("money",n),e+=hi.get("money").displayHeight,t.fillStyle(0,.5),t.fillRect(0,0,ht().width,e),this.game.events.emit("scene-created-".concat(fi))},update:function(){hi.forEach(function(t,e){switch(e){case"money":if(t.oldValue===le.players[0].money)return;return hi.get("money").setText(le.players[0].money.toLocaleString("en-Us")),void(t.oldValue=le.players[0].money);case"faction":if(!le.currentPlayer)return;if(t.oldValue===le.currentPlayer.name)return;return void hi.get("faction").setText("".concat(le.currentPlayer.name,"'s Turn")).setX(14+hi.get("round").displayWidth+10).setColor(0===le.currentPlayer.index?"goldenrod":"lightgrey");case"round":if(le.betweenRounds)return void hi.get("faction").setX(14+hi.get("round").displayWidth+10).setText("End of Round").setColor("lightgrey")}})}};function vi(t){return vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vi(t)}function di(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mi(r.key),r)}}function mi(t){var e=function(t){if("object"!=vi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vi(e)?e:e+""}function bi(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function gi(t,e){return t.get(ki(t,e))}function wi(t,e,n){return t.set(ki(t,e),n),n}function ki(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var xi=new Map,Oi=new WeakMap,Si=new WeakMap,Ti=new WeakMap,Pi=function(){return function(t,e){return e&&di(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),bi(this,Oi,void 0),bi(this,Si,void 0),bi(this,Ti,void 0),wi(Oi,this,{x:e.hex.x,y:e.hex.y}),wi(Si,this,n),wi(Ti,this,n.add.sprite(gi(Oi,this).x,gi(Oi,this).y,"goods.".concat(e.goodsType)).setDepth(20))},[{key:"scene",get:function(){return gi(Si,this)}},{key:"sprite",get:function(){return gi(Ti,this)}},{key:"x",get:function(){return gi(Oi,this).x}},{key:"y",get:function(){return gi(Oi,this).y}},{key:"update",value:function(t){gi(Oi,this).x=t.x,gi(Oi,this).y=t.y}}])}();var Ei=new Map;function ji(t){return ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ji(t)}function Mi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Ci(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mi(Object(n),!0).forEach(function(e){Ai(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mi(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Ai(t,e,n){return(e=function(t){var e=function(t){if("object"!=ji(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ji(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ji(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Wi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ii(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ii(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ii(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var qi="mainGameScene",Li=null,Ni={spriteOnActiveUnit:null,shortcutKeys:[]};function _i(){var t;if(void 0!==globalThis.Phaser){var e=ht();for(null===(t=Ni.spriteOnActiveUnit)||void 0===t||t.setActive(!1).setPosition(e.offscreen,e.offscreen).setDepth(0);Ni.shortcutKeys.length>0;)Ni.shortcutKeys.pop().destroy()}}function Fi(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ri(t,e){if(t){if("string"==typeof t)return Ui(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ui(t,e):void 0}}function Ui(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Hi(t){if(Array.isArray(t))return t}function Di(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.htmlElementId,n=t.imageKey,r=t.scene,i=document.getElementById(e),o=r.textures.get(n);o instanceof Phaser.Textures.Texture&&i instanceof Element&&i.append(o.getSourceImage())}le.events.on("unit-deactivated",_i),le.events.on("unit-moving",_i),le.events.on("unit-activated",function(t){_i(),function(t){if(void 0!==globalThis.Phaser){var e=t.detail.unit,n=e.hex;Ni.spriteOnActiveUnit.setActive(!0).setVisible(!0).setPosition(n.x,n.y).setDepth(98),["L","K","J","U","I","O"].forEach(function(t){var n=Wi(qe(t.toLowerCase(),e.row,e.col),2),r=n[0],i=n[1],o=mr.getHex({row:r,col:i});if(br(o,e)){var a=Li.add.text(o.x-100,o.y+ft/6,t,{fixedWidth:ft,font:"25pt Trebuchet MS",align:"center",color:"khaki",stroke:"black",strokeThickness:7}).setOrigin(0).setDepth(98);Ni.shortcutKeys.push(a),Li.cameras.getCamera("mini").ignore(a)}})}}(t)}),le.events.on("unit-activated",function(t){if(void 0!==globalThis.Phaser){var e=t.detail.unit.hex;Li.cameras.main.pan(e.x,e.y,500,"Linear",!0)}}),le.events.on("unit-created",function(t){var e,n;e=t.detail.unit,n=Li,be.has(e)||be.set(e,new xe(e,n)),be.has(e)}),le.events.on("goods-created",function(t){var e,n;e=t.detail.goods,n=Li,xi.has(e)||xi.set(e,new Pi(e,n)),xi.has(e)});const Vi={key:"tile-view",preload:function(){},create:function(t){var e=this,n=t.hex;if(dr(n)&&Cn.isTile(n.tile)){this.scene.pause("mainGameScene");var r=document.getElementById("tile-view");Object.keys(pt.laborers).forEach(function(t){e.load.image("laborers.".concat(t),"img/laborers/".concat(t,".png"))}),Object.entries(pt.improvements).forEach(function(t){var n=function(t,e){return Hi(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||Ri(t,e)||Fi()}(t,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&e.load.image("improvements.".concat(r),"img/improvements/".concat(i.tile,".png"))}),Di({imageKey:"tile.".concat(n.terrain.terrain),htmlElementId:"terrain",scene:this});var i=r.querySelector("#terrain");if(i instanceof Element){var o=document.createElement("div");o.classList.add("name"),o.innerHTML=n.terrain.name,i.appendChild(o)}if(n.tile.improvement){var a=r.querySelector("#improvements"),s=e.textures.exists("tile-view-improvement")?e.textures.get("tile-view-improvement"):e.textures.createCanvas("tile-view-improvement",ft,ft),u=s.getCanvas(),c=s.getContext(),l=I({dimensions:100,orientation:j.FLAT,origin:"topLeft"}),f=new at(l,$({width:1,height:1})).getHex({row:0,col:0});c.fillStyle="white",c.beginPath();var h=function(t){return Hi(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Ri(t)||Fi()}(f.corners.map(function(t){return yt({x:t.x,y:t.y-f.y+100},{x:f.y,y:f.y},.8)})),y=h[0],p=h.slice(1);c.moveTo(y.x,y.y),p.forEach(function(t){var e=t.x,n=t.y;c.lineTo(e,n)}),c.closePath(),c.fill();var v=this.textures.get("improvements.".concat(n.tile.improvement.key)).getSourceImage(),d=(s.width-v.width)/2-2,m=(s.height-v.height)/2;s.drawFrame("improvements.".concat(n.tile.improvement.key),null,d,m),s.refresh(),a.appendChild(u);var b=document.createElement("div");b.classList.add("name"),b.innerHTML=n.tile.improvement.title,a.appendChild(b),console.log("Sam, improvement:",n.tile.improvement)}n.tile.laborers instanceof Set?(r.querySelector("#laborers"),n.tile.laborers.forEach(function(t){Di({imageKey:"laborers.".concat(t.type),htmlElementId:"laborers",scene:e})})):console.log("Sam, no laborers set\u2026"),r.removeAttribute("hidden"),this.inputManager=new ri(this),this.events.on("sleep",function(){var t;r&&(r.setAttribute("hidden",!0),r.querySelectorAll("div").forEach(function(t){return t.innerHTML=""})),e.scene.wake("mainGameScene"),null===(t=e.inputManager)||void 0===t||t.disableKeyboardInput()}).on("shutdown",function(){r&&(r.setAttribute("hidden",!0),r.querySelectorAll("div").forEach(function(t){return t.innerHTML=""})),e.scene.wake("mainGameScene")})}else le.scenes.resume("mainGameScene")},update:function(){}},Gi={CityView:li,MainControls:pi,MainGame:{key:qi,autoStart:!0,preload:function(){var t=this;Object.entries(pt.terrains).forEach(function(e){var n=Wi(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("tile.".concat(r),"img/tiles/".concat(i.tile,".png"))}),this.load.spritesheet("cities","img/tiles/cities.png",{frameHeight:200,frameWidth:200}),Object.entries(pt.improvements).forEach(function(e){var n=Wi(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("improvements.".concat(r),"img/improvements/".concat(i.tile,".png"))}),Object.entries(pt.goods).forEach(function(e){var n=Wi(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("goods.".concat(r),"img/resources/".concat(i.tile,".png"))}),Object.keys(pt.laborers).forEach(function(e){t.load.image("laborers.".concat(e),"img/laborers/".concat(e,".png"))}),this.load.image("activeUnit","img/activeUnit.png"),Object.keys(pt.units).forEach(function(e){t.load.image("unit.".concat(e),"img/units/".concat(e,".png"))})},create:function(){var t=this;Li=this,le.graphics=Ci(Ci({},le.graphics),{},{territoryFills:this.add.graphics({x:0,y:0}).setDepth(2),territoryLines:this.add.graphics({x:0,y:0}).setDepth(2)}),mr.forEach(function(e){var n=pt.world[e.row][e.col];Object.assign(e,n,{tile:new Cn({hex:e}),terrain:Ci(Ci({},pt.terrains[n.terrain]),{},{terrain:n.terrain}),sprite:t.add.image(e.x,e.y,"tile.".concat(n.terrain)).setDepth(1).setInteractive(new Phaser.Geom.Polygon(mr.getHex({row:0,col:0}).corners),Phaser.Geom.Polygon.Contains),text:t.add.text(e.x-100,e.y+ft/3.6,e.row+"\xD7"+e.col,{fixedWidth:ft,font:"12pt Trebuchet MS",align:"center",color:"white"}).setOrigin(0)})}).forEach(function(t){"object"===ji(t.city)&&null!==t.city&&(t.city=new sr(Ci(Ci({},t.city),{},{col:t.col,row:t.row,nation:le.nations[t.city.nation]}))),"string"==typeof t.improvement&&t.tile.setImprovement(t.improvement)});var e=ht();Ni.spriteOnActiveUnit=this.add.image(e.offscreen,e.offscreen,"activeUnit").setActive(!1);var n=mr.pixelWidth,r=mr.pixelHeight,i=e.width/2,o=e.height/2;this.cameras.main.setBounds(-i,-o,n+2*i,r+2*o),this.cameras.main.ignore([le.graphics.territoryFills]);var a=400,s=800;window.innerHeight<600&&(a=300,s=500);var u=this.cameras.add(e.width-s,e.height-a,s,a);u.setZoom(.2).setName("mini").setBackgroundColor(0),u.centerOn(mr.pixelWidth/2,mr.pixelHeight/2),u.ignore([le.graphics.territoryLines,Ni.spriteOnActiveUnit]),le.players[0].addUnit("rancher",mr.getHex({row:2,col:3}),this),le.players[0].addUnit("farmer",mr.getHex({row:2,col:4}),this),le.players[0].addUnit("miner",mr.getHex({row:2,col:2}),this),le.players[0].addUnit("settler",mr.getHex({row:3,col:3}),this),le.players[0].addUnit("builder",mr.getHex({row:1,col:3}),this),this.inputManager=new ri(this),this.events.on("pause",function(){le.scenes.pause("mainControls"),_i(),le.domContainer.style.zIndex=0,t.inputManager.disableKeyboardInput()}).on("sleep",function(){le.scenes.sleep("mainControls"),le.domContainer.style.zIndex=0,t.inputManager.disableKeyboardInput()}),this.events.on("resume",function(){le.scenes.wake("mainControls"),le.currentPlayer.activateUnit(),t.inputManager.enableKeyboardInput()}).on("wake",function(){le.scenes.wake("mainControls"),le.currentPlayer.activateUnit(),t.inputManager.enableKeyboardInput()}),this.game.events.emit("scene-created-".concat(qi))},update:function(){var t=this;this.inputManager.update(),be.forEach(function(t,e){if(e.deleted)Oe(e);else{if(t.x!==e.hex.x||t.y!==e.hex.y){var n=function(t,e){var n=be.get(t);if(n)return new Promise(function(r){le.events.emit("unit-moving",{unit:t}),n.scene.tweens.add({targets:n.sprite,x:e.x,y:e.y,ease:"Quad.out",duration:800,yoyo:!1,onComplete:function(t){t.destroy(),r()}})})}(e,e.hex);t.update(e.hex),n.then(function(){console.log("Sam, emitting unit-moved"),le.events.emit("unit-moved",{unit:e,promise:n})})}t.sprite.setVisible(!0),le.activeUnit===e?t.sprite.setTint(16777215).setDepth(100):t.sprite.setTint(3684408).setDepth(11)}}),xi.forEach(function(t,e){if(e.deleted)!function(t){if(xi.has(t)){var e=xi.get(t);e.sprite.setVisible(!1),e.sprite.destroy(),xi.delete(t)}}(e);else{if(t.x!==e.hex.x||t.y!==e.hex.y){var n=function(t,e){var n=xi.get(t);if(n)return new Promise(function(t){n.scene.tweens.add({targets:n.sprite,x:e.x,y:e.y,ease:"Quad.out",duration:800,yoyo:!1,onComplete:function(e){e.destroy(),t()}})})}(e,e.hex);t.update(e.hex),n.then(function(){le.events.emit("goods-moved",{goods:e,promise:n})})}t.sprite.setVisible(!0)}}),mr.forEach(function(e){var n,r;e.tile.improvement.key?function(t,e){var n,r=null===(n=t.improvement)||void 0===n?void 0:n.key;if(r&&!Ei.has(t)){var i=e.add.image(t.hex.x,t.hex.y,"improvements.".concat(r)).setDepth(5);Ei.set(t,i)}}(e.tile,t):(n=e.tile,(r=Ei.get(n))&&(r.destroy(),Ei.delete(n)))})}},MainMenu:{key:"mainMenu",preload:function(){},create:function(){},update:function(){}},TechTree:{key:"techTree",preload:function(){},create:function(){},update:function(){}},TileView:Vi};void 0===globalThis.document&&(globalThis.document={add:function(){return this},addEventListener:function(){return this},appendChild:function(){return this},createElement:function(){return this},getElementById:function(){return this},querySelector:function(){return this},querySelectorAll:function(){return[]},remove:function(){return this},removeAttribute:function(){return this},setAttribute:function(){return this}},globalThis.document.classList=globalThis.document,globalThis.document.style=globalThis.document);var zi=null;function Bi(){le.domContainer.innerHTML="",le.domContainer.style.zIndex=0}function Ki(t){zi.setAttribute("hidden",!0),zi.innerHTML=""}le.events.on("phaser-ready",function(){null!=zi||(zi=document.getElementById("tile-menu"))}),le.events.on("unit-activated",function(t){var e,n=null===(e=t.detail)||void 0===e?void 0:e.unit;if(Ne.isUnit(n)&&le.activeUnit===n&&"undefined"!=typeof Element&&le.domContainer instanceof Element){le.domContainer.innerHTML="";var r=document.createElement("div");r.classList.add("unit-actions-menu");var i=le.currentPlayer,o={menu:"unit-actions-menu",hex:n.hex,unit:n,faction:i};Ur.getAvailableActions(o).forEach(function(t){var e=document.createElement("button");e.innerHTML=t.label,e.addEventListener("click",function(){t.execute(o)}),"string"==typeof t.description&&""!==t.description&&e.setAttribute("title",t.description),e.style.pointerEvents="auto",r.appendChild(e)}),le.domContainer.appendChild(r),le.domContainer.style.zIndex=1}}),le.events.on("unit-deactivated",Bi),le.events.on("unit-moving",Bi),le.events.on("doing-action",function(){Bi(),Ki()}),le.events.on("hex-clicked",function(t){var e,n,r=(null===(e=t.detail)||void 0===e?void 0:e.hex)||(null===(n=t.detail)||void 0===n||null===(n=n.unit)||void 0===n?void 0:n.hex);if(dr(r)&&Cn.isTile(r.tile)){Ki();var i={menu:"tile-menu",hex:r,unit:le.activeUnit,faction:le.currentPlayer},o=Ur.getAvailableActions(i);if(0!==o.length)if(1!==o.length||"activateUnit"===o[0].key){o.forEach(function(t){var e=document.createElement("button");e.innerHTML=t.label,e.addEventListener("click",function(){t.execute(i)}),"string"==typeof t.description&&""!==t.description&&e.setAttribute("title",t.description),e.style.pointerEvents="auto",zi.appendChild(e)});var a=document.createElement("button");a.innerHTML="Cancel",a.addEventListener("click",Ki),a.style.pointerEvents="auto",zi.appendChild(a),zi.style.zIndex=1,zi.removeAttribute("hidden")}else o[0].execute(i)}}),le.events.on("esc-pressed",Ki),yodasws.page("pageGame").setRoute({template:"pages/game/game.html",canonicalRoute:"/game/",route:"/game/?"}).on("load",()=>{le.nations=[new hn({index:0})],le.players=[new Qe({index:0}),new Qe({index:1}),new Qe({index:2})];const t=new Phaser.Game({type:Phaser.AUTO,...ht(),zoom:.5,backgroundColor:"#71ABFF",scene:Object.values(Gi),parent:document.querySelector("main"),dom:{createContainer:!0}});Promise.all([new Promise(e=>{const n=()=>{t.scene.getScene("mainGameScene")?e():setTimeout(n,50)};n()}),new Promise(e=>{const n=()=>{t.scene.getScene("mainControls")?e():setTimeout(n,50)};n()})]).then(()=>{le.events.emit("phaser-ready")}).then(()=>{t.scene.moveAbove("mainGameScene","mainControls")}),Object.assign(le,{scenes:t.scene,domContainer:t.domContainer}),t.domContainer.classList.add("game")}),window.json={},yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",()=>{})})()})();