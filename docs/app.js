"use strict";(()=>{"use strict";function e(e,n,r){t(e,n),n.set(e,r)}function t(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function n(e,t,n){return e.set(i(e,t),n),n}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(a=function(){return!!e})()}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function y(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}yodasws.page("pageBlog").setRoute({title:"Blog",canonicalRoute:"/blog/",template(e,...t){const n=t.join("/").replace(/\/+/g,"/").replace(/^\/|\/$/g,"").split("/").filter(e=>""!=e);return 0===n.length?"pages/blog/index.html":{canonicalRoute:"/blog/"+n.join("/")+"/",template:"pages/blog/"+n.join(".")+".html"}},route:"/blog(/.*)*"}).on("load",()=>{});var g=function(e){return Number.isFinite(e)&&!Number.isNaN(e)},w=function(e){return"object"==b(e)&&null!==e},x=function(e){return w(e)&&g(e.col)&&g(e.row)},k=function(e){return Array.isArray(e)&&g(e[0])&&g(e[1])},O=function(e,t){return t+e*(1&t)>>1},T=function(e,t){return function(e){return(e%8+8)%8}(e+t)},S=function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,3),n=t[0],r=t[1],i=t[2];return{q:n,r,s:void 0===i?-n-r:i}};function E(e){var t=e.q,n=e.r,r=e.s,i=g(t),o=g(n),a=g(r);if(i&&o&&a)return{q:t,r:n,s:r};if(i&&o)return{q:t,r:n,s:-t-n};if(i&&a)return{q:t,r:-t-r,s:r};if(o&&a)return{q:-n-r,r:n,s:r};throw new TypeError("Can't determine three cube coordinates from less than two coordinates. Received: { q: ".concat(t,", r: ").concat(n,", s: ").concat(r," }."))}var P=function(e){return e.FLAT="FLAT",e.POINTY="POINTY",e}(P||{});var j=function(){return y(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];f(this,e),d(this,"q",void 0),d(this,"r",void 0);var n=U(this,t),r=n.q,i=n.r;this.q=r,this.r=i},[{key:"center",get:function(){var e=this.width,t=this.height;return{x:e/2-this.x,y:t/2-this.y}}},{key:"col",get:function(){return I(this).col}},{key:"corners",get:function(){var e=this.orientation,t=this.width,n=this.height,r=this.x,i=this.y;return e===P.POINTY?C(t,n,r,i):A(t,n,r,i)}},{key:"dimensions",get:function(){return M.dimensions}},{key:"height",get:function(){var e=this.orientation,t=this.dimensions.yRadius;return e===P.POINTY?2*t:t*Math.sqrt(3)}},{key:"isFlat",get:function(){return this.orientation===P.FLAT}},{key:"isPointy",get:function(){return this.orientation===P.POINTY}},{key:"orientation",get:function(){return M.orientation}},{key:"origin",get:function(){return M.origin}},{key:"offset",get:function(){return M.offset}},{key:"row",get:function(){return I(this).row}},{key:"width",get:function(){var e=this.orientation,t=this.dimensions.xRadius;return e===P.POINTY?t*Math.sqrt(3):2*t}},{key:"x",get:function(){return W(this).x}},{key:"y",get:function(){return W(this).y}},{key:"s",get:function(){return-this.q-this.r}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return new this.constructor(e)}},{key:"equals",value:function(e){return function(e,t){if(x(e)&&x(t))return e.col===t.col&&e.row===t.row;if(Object.hasOwn(e,"col")||Object.hasOwn(t,"col"))throw new Error("Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ".concat(JSON.stringify(e)," and ").concat(JSON.stringify(t)));var n=k(e)?S(e):e,r=k(t)?S(t):t;return n.q===r.q&&n.r===r.r}(this,x(e)?N(this,e):e)}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.q,",").concat(this.r,")")}},{key:"translate",value:function(e){return function(e,t){var n=E(e),r=n.q,i=n.r,o=n.s,a=E(t),s={q:r+a.q,r:i+a.r,s:o+a.s};return e instanceof j?e.clone(s):s}(this,e)}}],[{key:"settings",get:function(){var e=this.prototype;return{dimensions:e.dimensions,orientation:e.orientation,origin:e.origin,offset:e.offset}}}])}(),M={dimensions:{xRadius:1,yRadius:1},orientation:P.POINTY,origin:{x:0,y:0},offset:-1},C=function(e,t,n,r){return[{x:n+.5*e,y:r-.25*t},{x:n+.5*e,y:r+.25*t},{x:n,y:r+.5*t},{x:n-.5*e,y:r+.25*t},{x:n-.5*e,y:r-.25*t},{x:n,y:r-.5*t}]},A=function(e,t,n,r){return[{x:n+.25*e,y:r-.5*t},{x:n+.5*e,y:r},{x:n+.25*e,y:r+.5*t},{x:n-.25*e,y:r+.5*t},{x:n-.5*e,y:r},{x:n-.25*e,y:r-.5*t}]};function F(e){var t=l(l({},M),e),n=t.dimensions,r=t.orientation,i=t.origin,o=t.offset;return function(e){function t(){return f(this,t),function(e,t,n){return t=s(t),function(e,t){if(t&&("object"==b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,n||[],s(e).constructor):t.apply(e,n))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),y(t,[{key:"dimensions",get:function(){return function(e,t){if(w(e)&&e.xRadius>0&&e.yRadius>0)return e;if(w(e)&&e.width>0&&e.height>0){var n=e.width,r=e.height;return t===P.POINTY?{xRadius:n/Math.sqrt(3),yRadius:r/2}:{xRadius:n/2,yRadius:r/Math.sqrt(3)}}if(e>0)return{xRadius:e,yRadius:e};throw new TypeError("Invalid dimensions: ".concat(JSON.stringify(e),". Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number."))}(n,r)}},{key:"orientation",get:function(){return r}},{key:"origin",get:function(){return function(e,t){if(function(e){return w(e)&&g(e.x)&&g(e.y)}(e))return e;if(!t)throw new TypeError("Supply a bounding box ({ width: number, height: number }). Received: ".concat(JSON.stringify(t)));if("topLeft"===e)return{x:-.5*t.width,y:-.5*t.height};throw new TypeError("Invalid origin: ".concat(JSON.stringify(e),". Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'."))}(i,this)}},{key:"offset",get:function(){return o}}])}(j)}var I=function(e){var t=e.q,n=e.r,r=e.offset;return e.isPointy?function(e,t,n){return{col:e+O(n,t),row:t}}(t,n,r):function(e,t,n){return{col:e,row:t+O(n,e)}}(t,n,r)},W=function(e){var t=e.orientation,n=e.dimensions,r=n.xRadius,i=n.yRadius,o=e.origin,a=o.x,s=o.y,u=e.q,c=e.r;return t===P.POINTY?{x:r*Math.sqrt(3)*(u+c/2)-a,y:3*i/2*c-s}:{x:3*r/2*u-a,y:i*Math.sqrt(3)*(c+u/2)-s}},q=function(e,t,n){var r=e-O(n,t);return{q:r,r:t,s:-r-t}},L=function(e,t,n){var r=e,i=t-O(n,e);return{q:r,r:i,s:-r-i}},N=function(e,t){var n=e.offset,r=e.orientation,i=t.col,o=t.row;return r===P.POINTY?q(i,o,n):L(i,o,n)},H=function(e){var t=E(e),n=t.q,r=t.r,i=t.s,o=Math.round(n),a=Math.round(r),s=Math.round(i),u=Math.abs(n-o),c=Math.abs(r-a),l=Math.abs(i-s);return u>c&&u>l?o=-a-s:c>l?a=-o-s:s=-o-a,{q:o,r:a,s}};function U(e,t){return k(t)?S(t):x(t)?N(e,t):E(t)}function R(e,t,n){var r=U(e,t),i=r.q,o=r.r,a=r.s,s=U(e,n),u=s.q,c=s.r,l=s.s;return Math.max(Math.abs(i-u),Math.abs(o-c),Math.abs(a-l))}var D=function(e){return e.CLOCKWISE="CLOCKWISE",e.COUNTERCLOCKWISE="COUNTERCLOCKWISE",e}(D||{}),_=function(e){return e[e.N=0]="N",e[e.NE=1]="NE",e[e.E=2]="E",e[e.SE=3]="SE",e[e.S=4]="S",e[e.SW=5]="SW",e[e.W=6]="W",e[e.NW=7]="NW",e}(_||{}),V=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],z=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],G=function(e,t){return e.clone(e.isPointy?function(e,t){var n=e.offset,r=e.q,i=e.r,o=e.col,a=e.row;if(t===_.S||t===_.N){var s=t===_.S?a+1:a-1;return q(o,s,n)}var u=V[t];return{q:r+u.q,r:i+u.r}}(e,t):function(e,t){var n=e.offset,r=e.q,i=e.r,o=e.col,a=e.row;if(t===_.E||t===_.W){var s=t===_.E?o+1:o-1;return L(s,a,n)}var u=z[t];return{q:r+u.q,r:i+u.r}}(e,t))};function B(e){return Array.isArray(e)?function(t,n){var r,i=[],a=n,s=o(e);try{for(s.s();!(r=s.n()).done;){var u,c=o((0,r.value)(t,a));try{for(c.s();!(u=c.n()).done;){var l=u.value;i.push(a=l)}}catch(e){c.e(e)}finally{c.f()}}}catch(e){s.e(e)}finally{s.f()}return i}:e}function K(e){return function(e){return e.direction in _}(e)?function(e){var t=e.start,n=e.direction,r=e.length;return function(e,i){var o=[],a=e(null!=t?t:i);!t&&i&&(a=G(a,n));for(var s=0;s<r;s++)o.push(a),a=G(a,n);return o}}(e):function(e){var t=e.start,n=e.stop;return function(e,r){for(var i=[],o=e(null!=t?t:r),a=function(e,t){return function(n){return{q:e.q*(1-n)+t.q*n,r:e.r*(1-n)+t.r*n}}}(Y(o),Y(U(o,n))),s=R(o,o,n),u=1/Math.max(s,1),c=!t&&r?1:0;c<=s;c++){var l=H(a(u*c));i.push(e(l))}return i}}(e)}function Y(e){return{q:e.q+1e-6,r:e.r+1e-6,s:e.s+-2e-6}}function Q(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).includeSource,r=void 0===n||n;return function(n,i){var a,s=[],u=o(B(e)(n,i));try{for(u.s();!(a=u.n()).done;){var c=a.value;r&&s.push(c);var l,f=o(B(t)(n,c));try{for(f.s();!(l=f.n()).done;){var h=l.value;s.push(h)}}catch(e){f.e(e)}finally{f.f()}}}catch(e){u.e(e)}finally{u.f()}return s}}function X(e,t){return function(n,r){var i,o=t?function(e,t,n){var r=n.isPointy,i=n.offset,o=J(e,r,i),a=o.col,s=o.row,u=J(t,r,i),c=u.col,l=u.row,f=$[(a<c?"A":"B")+(s<l?"A":"B")],h=f.swapWidthHeight,y=f.direction,d=Math.abs(a-c)+1,v=Math.abs(s-l)+1;return{width:h?v:d,height:h?d:v,start:e,direction:y}}(e,t,n()):e,a=o.width,s=o.height,u=o.start,c=o.direction,l=void 0===c?_.E:c,f=null!==(i=null!=u?u:r)&&void 0!==i?i:[0,0],h=Q(K({start:f,direction:T(l,2),length:s}),K({direction:l,length:a-1}))(n,f);return!u&&r?h.slice(1):h}}function J(e,t,n){if(x(e))return e;var r=k(e)?S(e):E(e),i=r.q,o=r.r;return I({q:i,r:o,isPointy:t,offset:n})}var $={AA:{swapWidthHeight:!1,direction:_.E},AB:{swapWidthHeight:!0,direction:_.N},BA:{swapWidthHeight:!0,direction:_.S},BB:{swapWidthHeight:!1,direction:_.W}};function Z(e){var t=e.center,n=e.rotation,r=void 0===n?D.CLOCKWISE:n;return function(n,i){var o,a,s=r.toUpperCase(),u=[],c=e.radius,l=g(c);l?a=n(t).translate({q:c,s:-c}):c=R(a=n(null!==(o=e.start)&&void 0!==o?o:i),t,a);var f=U(a,t),h=n({q:f.q,r:f.r-c,s:f.s+c});if(s===D.CLOCKWISE)for(var y=0;y<6;y++)for(var d=0;d<c;d++){var v=ee[y],p=v.q,m=v.r;h=n({q:h.q+p,r:h.r+m}),u.push(h)}else for(var b=5;b>=0;b--)for(var w=0;w<c;w++){var x=ee[b],k=x.q,O=x.r;h=n({q:h.q-k,r:h.r-O}),u.push(h)}var T=!l&&!e.start&&i,S=u.findIndex(function(e){return e.equals(a)});return u.slice(S+(T?1:0)).concat(u.slice(0,S))}}var ee=[{q:1,r:0},{q:0,r:1},{q:-1,r:1},{q:-1,r:0},{q:0,r:-1},{q:1,r:-1}];function te(e){var t=e.radius,n=e.start,r=e.rotation;return function(e,i){var o,a=null!==(o=null!=n?n:i)&&void 0!==o?o:[0,0],s=!n&&i?t:t+1;return Q(K({start:n,direction:_.N,length:s}),Z({center:a,rotation:r}))(e,i)}}var ne=new WeakMap,re=new WeakMap,ie=new WeakSet,oe=function(){function a(o){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(f(this,a),function(e,n){t(e,n),n.add(e)}(this,ie),e(this,ne,void 0),e(this,re,new Map),o instanceof a)return n(ne,this,r(ne,o)),void this.setHexes(o);n(ne,this,o),this.setHexes(i(ie,this,se).call(this,s))}return y(a,[{key:"size",get:function(){return r(re,this).size}},{key:"pixelWidth",get:function(){if(0===this.size)return 0;var e=this.hexPrototype,t=e.isPointy,n=e.width,r=this.toArray(),i=t?r.sort(function(e,t){return t.s-e.s||e.q-t.q}):r.sort(function(e,t){return e.q-t.q}),o=i[0];return i[i.length-1].x-o.x+n}},{key:"pixelHeight",get:function(){if(0===this.size)return 0;var e=this.hexPrototype,t=e.isPointy,n=e.height,r=this.toArray(),i=t?r.sort(function(e,t){return e.r-t.r}):r.sort(function(e,t){return t.s-e.s||e.r-t.r}),o=i[0];return i[i.length-1].y-o.y+n}},{key:Symbol.iterator,value:function(){return r(re,this).values()}},{key:"hexPrototype",get:function(){return r(ne,this).prototype}},{key:"createHex",value:function(e){return new(r(ne,this))(e)}},{key:"getHex",value:function(e){var t=this.createHex(e);return r(re,this).get(t.toString())}},{key:"hasHex",value:function(e){return r(re,this).has(e.toString())}},{key:"setHexes",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,s=a instanceof j?a:new(r(ne,this))(a);i(ie,this,ae).call(this,s)}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"filter",value:function(e){var t,n=new a(r(ne,this)),s=o(this);try{for(s.s();!(t=s.n()).done;){var u=t.value;e(u)&&i(ie,n,ae).call(n,u)}}catch(e){s.e(e)}finally{s.f()}return n}},{key:"map",value:function(e){var t,n=new a(r(ne,this)),s=o(this);try{for(s.s();!(t=s.n()).done;){var u=t.value;i(ie,n,ae).call(n,e(u))}}catch(e){s.e(e)}finally{s.f()}return n}},{key:"traverse",value:function(e){var t,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).bail,s=void 0!==n&&n,u=new a(r(ne,this)),c=o(i(ie,this,se).call(this,e));try{for(c.s();!(t=c.n()).done;){var l=t.value,f=this.getHex(l);if(f)i(ie,u,ae).call(u,f);else if(s)return u}}catch(e){c.e(e)}finally{c.f()}return u}},{key:"forEach",value:function(e){var t,n=o(this);try{for(n.s();!(t=n.n()).done;)e(t.value)}catch(e){n.e(e)}finally{n.f()}return this}},{key:"reduce",value:function(e,t){if(void 0===t){var n,r,i,a,s=o(this);try{for(s.s();!(a=s.n()).done;){var u=a.value;r=i,i=u,r&&(n=e(r,i))}}catch(e){s.e(e)}finally{s.f()}return n}var c,l=t,f=o(this);try{for(f.s();!(c=f.n()).done;)l=e(l,c.value)}catch(e){f.e(e)}finally{f.f()}return l}},{key:"toArray",value:function(){return Array.from(this)}},{key:"toJSON",value:function(){var e=this.hexPrototype;return{hexSettings:{dimensions:e.dimensions,orientation:e.orientation,origin:e.origin,offset:e.offset},coordinates:this.toArray()}}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.size,")")}},{key:"pointToHex",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).allowOutside,n=void 0===t||t,r=function(e,t){var n=e.dimensions,r=n.xRadius,i=n.yRadius,o=e.origin,a=e.orientation,s=t.x,u=t.y;return s+=o.x,u+=o.y,a===P.POINTY?H({q:Math.sqrt(3)*s/(3*r)-u/(3*i),r:2/3*(u/i)}):H({q:2/3*(s/r),r:Math.sqrt(3)*u/(3*i)-s/(3*r)})}(this.hexPrototype,e),i=this.getHex(r);return n?null!=i?i:this.createHex(r):i}},{key:"distance",value:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside;if(void 0===n||n)return R(this.hexPrototype,e,t);var r=this.getHex(e),i=this.getHex(t);return r&&i?R(this.hexPrototype,r,i):void 0}},{key:"neighborOf",value:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowOutside,r=void 0===n||n,i=G(this.createHex(e),t),o=this.getHex(i);return r?null!=o?o:i:o}}],[{key:"fromIterable",value:function(e){var t=e[Symbol.iterator]().next().value;if(!t)throw new TypeError("Can't create grid from empty iterable: ".concat(JSON.stringify(e)));return new a(t.constructor,e)}},{key:"fromJSON",value:function(e,t){var n=e.hexSettings,r=e.coordinates;if(t){var i=r.map(t);return new a(i.length>0?i[0].constructor:t({q:0,r:0},0,[{q:0,r:0}]).constructor,i)}var o=F(n);return new a(o,r.map(function(e){return new o(e)}))}}])}();function ae(e){r(re,this).set(e.toString(),e)}function se(e){return i(ie,this,ue).call(this,e)?i(ie,this,ce).call(this,e):Array.isArray(e)&&i(ie,this,ue).call(this,e[0])?i(ie,this,ce).call(this,B(e)):e}function ue(e){return"function"==typeof e}function ce(e){return e(this.createHex.bind(this))}const le=JSON.parse("{\"fogOfWar\":true,\"actions\":[{\"key\":\"move\",\"label\":\"Move here\",\"description\":\"Move to target location\",\"icon\":\"path.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"isLegalMove\",\"execute\":\"startMoveTo\"},{\"key\":\"wait\",\"label\":\"Wait\",\"description\":\"Wait and come back later this turn\",\"icon\":\"wait.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":true,\"execute\":\"wait\"},{\"key\":\"skip\",\"label\":\"Stay\",\"description\":\"Stay here, done moving\",\"icon\":\"skip.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":true,\"execute\":\"skip\"},{\"key\":\"city-view\",\"label\":\"View City\",\"description\":\"View information about this city\",\"showIn\":[\"tile-menu\"],\"isValid\":\"isCityTile\",\"execute\":\"startCityView\"},{\"key\":\"build-farm-here\",\"label\":\"Build Farm\",\"description\":\"Construct a farm on this tile. The farmer unit will be consumed and become a laborer to work the farm.\",\"icon\":\"farmer-hoeing.png\",\"unitTypes\":[\"farmer\"],\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"isFarmBuildable\",\"execute\":\"buildFarm\"},{\"key\":\"build-farm\",\"label\":\"Build Farm\",\"description\":\"Construct a farm on this tile. The farmer unit will be consumed and become a laborer to work the farm.\",\"icon\":\"farm-pin.png\",\"unitTypes\":[\"farmer\"],\"showIn\":[\"tile-menu\"],\"isValid\":\"isFarmBuildable\",\"execute\":\"buildFarm\"},{\"key\":\"tile\",\"label\":\"Information on space\",\"description\":\"View information about this tile\",\"icon\":\"search.png\",\"showIn\":[\"tile-menu\"],\"isValid\":\"hexTileValid\",\"command\":\"startTileView\"},{\"key\":\"end-turn\",\"label\":\"End Turn\",\"description\":\"End Turn\",\"icon\":\"end-turn.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"currentPlayerTurn\",\"execute\":\"endTurn\"},{\"key\":\"center-map\",\"label\":\"Center Map\",\"description\":\"Center Map\",\"icon\":\"center.png\",\"showIn\":[\"unit-actions-menu\"],\"isValid\":\"currentPlayerTurn\",\"command\":\"centerMap\"}],\"improvements\":{\"farm\":{\"title\":\"Subsistence Farm\",\"tile\":\"farm\",\"housing\":1,\"terrains\":{\"grass\":{\"food\":2,\"turnsForProduction\":1},\"marsh\":{\"food\":2,\"turnsForProduction\":6}}}},\"FactionNames\":[\"Appius Claudius Caecus\",\"Marcus Valerius Corvus\",\"Cnaeus Flavius\"],\"LaborerNames\":{\"praenomina\":{\"1\":[\"Mamercus\",\"Appius\",\"Agrippa\",\"Opiter\"],\"0.5\":[\"Marcus\",\"Gaius\",\"Lucius\",\"Publius\",\"Quintus\",\"Titus\",\"Tiberius\",\"Aulus\",\"Sextus\",\"Gnaeus\"],\"0.75\":[\"Spurius\",\"Numerius\",\"Servius\",\"Decimus\"]},\"cognomina\":{\"1\":[\"Sabinus\",\"Picenus\",\"Etruscus\",\"Campanus\",\"Samnis\"],\"0.3\":[\"Cincinnatus\",\"Barbatus\",\"Rufus\",\"Naso\",\"Longus\",\"Brutus\",\"Flavus\",\"Niger\",\"Paullus\",\"Crassus\",\"Varus\",\"Cicero\"],\"0.5\":[\"Blandus\",\"Cato\",\"Celer\",\"Durus\",\"Quietus\",\"Severus\"],\"0.75\":[\"Agricola\",\"Silvanus\",\"Montanus\",\"Pratensis\",\"Ripanus\",\"Paludatus\"]}},\"NationNames\":[\"Roman Republic\"],\"StandardMovable\":{\"moveOnLand\":true,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"forest\":18,\"grass\":12,\"hill\":18,\"marsh\":24,\"mountain\":24,\"ocean\":12}},\"ResourceValues\":{\"food\":10},\"ResourceTransporter\":{\"moveOnLand\":true,\"moveOnWater\":false,\"movementPoints\":12,\"movementCosts\":{\"forest\":18,\"grass\":12,\"hill\":18,\"marsh\":24,\"mountain\":24,\"ocean\":12}},\"goods\":{\"food\":{\"tile\":\"wheat\"}},\"terrains\":{\"forest\":{\"name\":\"Forest\",\"movementCost\":18,\"food\":0,\"tile\":\"forest\"},\"grass\":{\"name\":\"Grassland\",\"movementCost\":12,\"food\":0,\"tile\":\"grass\"},\"hill\":{\"name\":\"Hill\",\"movementCost\":12,\"food\":0,\"tile\":\"grass\"},\"marsh\":{\"name\":\"Marsh\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"swamp\"},\"mountain\":{\"name\":\"Mountain\",\"movementCost\":12,\"food\":0,\"tile\":\"mountains\"},\"ocean\":{\"name\":\"Ocean\",\"movementCost\":12,\"food\":0,\"isWater\":true,\"tile\":\"ocean\"}},\"laborers\":{\"farmer\":{\"name\":\"Farmer\"}},\"units\":{\"farmer\":{\"name\":\"Farmer\",\"defense\":0,\"moveOnWater\":false,\"movementPoints\":12,\"productionCosts\":{\"addToQueue\":{\"money\":10},\"removeFromQueue\":{\"food\":10}},\"movementCosts\":{\"grass\":12,\"hill\":12,\"mountain\":24,\"marsh\":24}},\"warrior\":{\"name\":\"Warrior\",\"attack\":1,\"attackCities\":true,\"defense\":1,\"moveOnWater\":false,\"movementPoints\":12,\"productionCosts\":{\"addToQueue\":{\"money\":50},\"removeFromQueue\":{\"food\":30}},\"movementCosts\":{\"grass\":12,\"hill\":12,\"mountain\":24,\"marsh\":24}}},\"world\":[[{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"},{\"terrain\":\"ocean\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"marsh\"},{\"terrain\":\"marsh\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"forest\"},{\"terrain\":\"forest\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"marsh\"},{\"terrain\":\"grass\",\"city\":{\"nation\":0}},{\"terrain\":\"grass\"},{\"terrain\":\"forest\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"mountain\"},{\"terrain\":\"forest\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"forest\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"forest\"},{\"terrain\":\"forest\"},{\"terrain\":\"forest\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"forest\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}],[{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"forest\"},{\"terrain\":\"mountain\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"},{\"terrain\":\"grass\"}]]}");var fe=200;void 0===globalThis.window&&(globalThis.window={visualViewport:{height:1080,width:1920}});var he=function(){return{height:window.visualViewport.height/.5,width:window.visualViewport.width/.5,offscreen:-2*Math.max(window.visualViewport.width,window.visualViewport.height)}};function ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9,r=(e.y-t.y)/(e.x-t.x),i=e.y-r*e.x,o=(e.x-t.x)*n+t.x;return{x:o,y:r*o+i}}function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pe(r.key),r)}}function pe(e){var t=function(e){if("object"!=de(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==de(t)?t:t+""}function me(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function be(e,t){return e.get(we(e,t))}function ge(e,t,n){return e.set(we(e,t),n),n}function we(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var xe=new WeakMap,ke=new WeakMap,Oe=new WeakMap,Te=function(){return e=function e(t){var n=t.hex,r=t.numUnits,i=void 0===r?1:r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),me(this,xe,void 0),me(this,ke,new Set),me(this,Oe,void 0),!ar(n))throw new TypeError("Housing expects to be assigned object instance of Hex!");ge(xe,this,n),ge(Oe,this,i)},(t=[{key:"hex",get:function(){return be(xe,this)}},{key:"laborers",get:function(){return be(ke,this)},set:function(e){if(!Laborer.isLaborer(e))throw new TypeError("City.laborers expects to be assigned object instance of Laborer!");if(be(ke,this).size>=be(Oe,this))throw new Error("Housing.laborers cannot exceed numUnits!");laborers.add(e)}},{key:"numUnits",get:function(){return be(Oe,this)}}])&&ve(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function Ee(){Ee=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new C(r||[]);return i(a,"_invoke",{value:E(e,n,s)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",y="suspendedYield",d="executing",v="completed",p={};function m(){}function b(){}function g(){}var w={};c(w,a,function(){return this});var x=Object.getPrototypeOf,k=x&&x(x(A([])));k&&k!==n&&r.call(k,a)&&(w=k);var O=g.prototype=m.prototype=Object.create(w);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function S(e,t){function n(i,o,a,s){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==Se(l)&&r.call(l,"__await")?t.resolve(l.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return n("throw",e,a,s)})}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t(function(t,i){n(e,r,t,i)})}return o=o?o.then(i,i):i()}})}function E(t,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=P(s,r);if(u){if(u===p)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var c=f(t,n,r);if("normal"===c.type){if(i=r.done?v:y,c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function P(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,P(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=f(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,p;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function A(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(Se(t)+" is not iterable")}return b.prototype=g,i(O,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},T(S.prototype),c(S.prototype,s,function(){return this}),t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new S(l(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(O),c(O,u,"Generator"),c(O,a,function(){return this}),c(O,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),p}},t}var Pe=Ee().mark(Ye);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach(function(t){Ce(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ce(e,t,n){return(t=Fe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Fe(r.key),r)}}function Fe(e){var t=function(e){if("object"!=Se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}function Ie(e,t,n){We(e,t),t.set(e,n)}function We(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function qe(e,t){return e.get(Ne(e,t))}function Le(e,t,n){return e.set(Ne(e,t),n),n}function Ne(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function He(e,t,n,r){if(!ar(e))throw new TypeError("FindPath expects a Hex as start!");if(!ar(t))throw new TypeError("FindPath expects a Hex as end!");if(!Ke.isInstanceofMovable(n))throw new TypeError("FindPath expects a Movable!");var i=[],o=[],a=!1;e.parent=void 0,i.push(e),e.g_cost=0;for(var s=function(){var e=i.sort(function(e,t){return e.f_cost-t.f_cost||e.h_cost-t.h_cost})[0];if(e===t)return a=!0,1;i=i.filter(function(t){return e!==t}),o.push(e),r.traverse(Z({center:[e.q,e.r],radius:1})).forEach(function(a){o.includes(a)||ur(a,n)&&(a.g_cost=e.g_cost+cr(n,a,e),a.h_cost=r.distance(e,t),a.f_cost=a.g_cost+a.h_cost,i.includes(a)||(a.parent=e,i.push(a)))})};i.length>0&&!s(););if(!a)return[];var u=[t],c=t;do{var l;(c=c.parent)!==e&&u.unshift(c)}while(ar(null===(l=c)||void 0===l?void 0:l.parent));return u}var Ue=new WeakMap,Re=new WeakMap,De=new WeakMap,_e=new WeakMap,Ve=new WeakMap,ze=new WeakMap,Ge=new WeakMap,Be=new WeakSet,Ke=function(){function e(t){var n=t.base,r=void 0===n?{}:n,i=t.hex,o=t.faction;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){We(e,t),t.add(e)}(this,Be),Ie(this,Ue,le.StandardMovable),Ie(this,Re,!1),Ie(this,De,void 0),Ie(this,_e,void 0),Ie(this,Ve,null),Ie(this,ze,0),Ie(this,Ge,[]),!ar(i))throw new TypeError("Movable expects to be assigned a Hex!");Le(De,this,Cn.isFaction(o)?o:i.tile.faction),Le(_e,this,i),Le(Ue,this,Me(Me(Me({},qe(Ue,this)),r),{},{movementCosts:Me(Me({},qe(Ue,this).movementCosts),r.movementCosts)}))}return t=e,n=[{key:"baseMovementPoints",get:function(){return qe(Ue,this).movementPoints}},{key:"deleted",get:function(){return qe(Re,this)},set:function(e){Le(Re,this,!!e)}},{key:"faction",get:function(){return qe(De,this)}},{key:"canContinueOnPath",get:function(){return null!==qe(Ve,this)&&qe(Ge,this).length>0&&qe(ze,this)>0}},{key:"hex",get:function(){return qe(_e,this)}},{key:"movementCosts",get:function(){return qe(Ue,this).movementCosts}},{key:"moveOnWater",get:function(){return qe(Ue,this).moveOnWater||!1}},{key:"moves",get:function(){return qe(ze,this)}},{key:"row",get:function(){return qe(_e,this).row}},{key:"col",get:function(){return qe(_e,this).col}},{key:"activate",value:function(){!0===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.canContinueOnPath?this.moveOneTurn():Le(Ve,this,null)}},{key:"deactivate",value:function(){!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Le(ze,this,0)}},{key:"destroy",value:function(){Le(ze,this,0),Le(Ge,this,[]),this.deleted=!0,Le(Ve,this,null)}},{key:"prepareForNewTurn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sr;Le(ze,this,qe(Ue,this).movementPoints),qe(Ge,this).length>1&&this.setPath(qe(Ge,this)[qe(Ge,this).length-1],e)}},{key:"setPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sr;if(!ar(e))throw new TypeError("Movable.setPath expects to be assigned a Hex!");var n=He(qe(_e,this),e,this,t);return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sr;if(!Array.isArray(e)||0===e.length||e.some(function(e){return!ar(e)}))return!1;for(var n=1;n<e.length;n++){var r=e[n-1],i=e[n];if(1!==t.distance(r,i))return!1}return!0}(n,t)?(Le(Ge,this,n),Le(Ve,this,Ne(Be,this,Ye).call(this))):(console.warn("Sam, no path found!"),Le(Ve,this,null))}},{key:"setPathAndMove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sr;this.setPath(e,t),null!==qe(Ve,this)&&this.moveOneTurn()}},{key:"moveOneStep",value:function(){if(null!==qe(Ve,this)){var e=qe(Ve,this).next();Le(_e,this,e.value),(e.done||qe(Ge,this).length<=0)&&Le(Ve,this,null)}}},{key:"moveOneTurn",value:function(){for(;this.canContinueOnPath;)this.moveOneStep()}}],r=[{key:"isInstanceofMovable",value:function(t){return t instanceof e}},{key:"isActivatableMovable",value:function(t){return e.isInstanceofMovable(t)&&!1===t.deleted}},{key:"isMovableCanMove",value:function(t){return e.isActivatableMovable(t)&&t.moves>0}}],n&&Ae(t.prototype,n),r&&Ae(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function Ye(){var e,t;return Ee().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(qe(Ge,this).length>0)){n.next=12;break}if(e=qe(Ge,this)[0],t=cr(this,e),!(qe(ze,this)<t)){n.next=6;break}return this.deactivate(!0),n.abrupt("break",12);case 6:return Le(ze,this,qe(ze,this)-t),Le(_e,this,e),n.next=10,qe(Ge,this).shift();case 10:n.next=0;break;case 12:case"end":return n.stop()}},Pe,this)}function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function Xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,nt(r.key),r)}}function Je(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Je=function(){return!!e})()}function $e(e,t,n,r){var i=Ze(et(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function Ze(){return Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=et(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Ze.apply(null,arguments)}function et(e){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(e)}function tt(e,t){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tt(e,t)}function nt(e){var t=function(e){if("object"!=Qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Qe(t)?t:t+""}function rt(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function it(e,t){return e.get(at(e,t))}function ot(e,t,n){return e.set(at(e,t),n),n}function at(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var st,ut,ct=new WeakMap,lt=new WeakMap,ft=new WeakMap,ht=new WeakMap,yt=new WeakMap,dt=new WeakMap,vt=function(e){function t(e,n){var r,i=n.hex,o=n.num,a=void 0===o?1:o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!t.isValidGoodsType(e))throw new TypeError("Unknown Goods type '".concat(e,"'"));return rt(r=function(e,t,n){return t=et(t),function(e,t){if(t&&("object"==Qe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Je()?Reflect.construct(t,n||[],et(e).constructor):t.apply(e,n))}(this,t,[{base:le.ResourceTransporter,hex:i}]),ct,new Kt),rt(r,lt,void 0),rt(r,ft,void 0),rt(r,ht,0),rt(r,yt,void 0),rt(r,dt,void 0),ot(lt,r,e),ot(ft,r,a),ot(yt,r,i),r.events.on("moved",function(e){ar(it(dt,r))&&r.hex===it(dt,r)&&e.detail.promise.finally(function(){r.destroy()})}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tt(e,t)}(t,e),n=t,r=[{key:"events",get:function(){return it(ct,this)}},{key:"goodsType",get:function(){return it(lt,this)}},{key:"num",get:function(){return it(ft,this)},set:function(e){if(!Number.isInteger(e)||e<0)throw new TypeError("Goods.num expects to be assigned a nonnegative integer!");0===e&&this.destroy(),ot(ft,this,e)}},{key:"rounds",get:function(){return it(ht,this)},set:function(e){if(!Number.isInteger(e)||e<0)throw new TypeError("Goods.rounds expects to be assigned a nonnegative integer!");ot(ht,this,e),"food"===it(lt,this)&&(this.events.emit("rounds-updated",{rounds:it(ht,this),maxRounds:this.MaxFoodRounds,percentage:(t.MaxFoodRounds-it(ht,this))/t.MaxFoodRounds*100}),it(ht,this)>=t.MaxFoodRounds&&this.destroy())}},{key:"start",get:function(){return it(yt,this)}},{key:"destroy",value:function(){$e(t,"destroy",this,3)([]),Yt.events.emit("goods-destroyed",{goods:this}),this.events.emit("destroyed")}},{key:"setPath",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sr;ot(dt,this,null!==$e(t,"setPath",this,3)([e,n])&&e)}}],i=[{key:"isGoods",value:function(e){return e instanceof t}},{key:"isValidGoodsType",value:function(e){var t;return"object"===Qe(null!==(t=le.goods[e])&&void 0!==t&&t)}}],r&&Xe(n.prototype,r),i&&Xe(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(Ke);function pt(e){var t,n,r,i=e.index,o=null!==(t=[3329330,16711680,255][i])&&void 0!==t?t:11184810,a=(i+1)%3,s=null!==(n=null===(r=le.NationNames)||void 0===r?void 0:r[i])&&void 0!==n?n:"Unknown";Object.defineProperties(this,{color:{enumerable:!0,get:function(){return o}},frame:{enumerable:!0,get:function(){return a}},index:{enumerable:!0,get:function(){return i}},name:{enumerable:!0,get:function(){return s}}})}st=vt,(ut=nt(ut="MaxFoodRounds"))in st?Object.defineProperty(st,ut,{value:5,enumerable:!0,configurable:!0,writable:!0}):st[ut]=5,Object.assign(pt.prototype,{}),pt.isNation=function(e){return e instanceof pt};const mt=pt;function bt(e){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(e)}function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(n),!0).forEach(function(t){xt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function xt(e,t,n){return(t=Ot(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ot(r.key),r)}}function Ot(e){var t=function(e){if("object"!=bt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=bt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==bt(t)?t:t+""}function Tt(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function St(e,t){return e.get(Pt(e,t))}function Et(e,t,n){return e.set(Pt(e,t),n),n}function Pt(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function jt(e,t,n){var r;return!!ar(e)&&"string"==typeof t&&""!==t&&t in le.improvements&&""===n.key&&e.terrain.terrain in(null===(r=le.improvements[t])||void 0===r?void 0:r.terrains)&&!Vn.isCity(e.city)}var Mt=new WeakMap,Ct=new WeakMap,At=new WeakMap,Ft=new WeakMap,It=new WeakMap,Wt=new WeakMap,qt=function(){function e(t){var n=t.hex;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Tt(this,Mt,{faction:new Map,nation:new Map}),Tt(this,Ct,void 0),Tt(this,At,void 0),Tt(this,Ft,{key:""}),Tt(this,It,new Set),Tt(this,Wt,0),!ar(n))throw new TypeError("Tile expects to be assigned object instance of Hex!");Et(Ct,this,n)}return function(e,t,n){return t&&kt(e.prototype,t),n&&kt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"faction",get:function(){var e={faction:null,claim:0};return St(Mt,this).faction.forEach(function(t,n){e.claim<t&&(e.faction=n,e.claim=t)}),e.faction}},{key:"hex",get:function(){return St(Ct,this)}},{key:"improvement",get:function(){return St(At,this)||!1}},{key:"laborers",get:function(){return St(It,this)},set:function(e){if(!Nt.isLaborer(e))throw new TypeError("Tile.laborers expects to be assigned object instance of Laborer!");St(It,this).add(e)}},{key:"nation",get:function(){var e={nation:null,claim:0};return St(Mt,this).nation.forEach(function(t,n){e.claim<t&&(e.nation=n,e.claim=t)}),e.nation}},{key:"claims",value:function(e,t){var n=null;return Cn.isFaction(e)?n="faction":mt.isNation(e)&&(n="nation"),n in St(Mt,this)?(Number.isInteger(t)&&0!==t&&St(Mt,this)[n].set(e,(St(Mt,this)[n].get(e)||0)+t),St(Mt,this)[n].get(e)||0):St(Mt,this)}},{key:"claimTerritory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Number.isFinite(t)&&0!==t){var n,r=void 0;mt.isNation(e)&&mt.isNation(this.nation)?r=this.nation.index:Cn.isFaction(e)&&Cn.isFaction(this.faction)&&(r=this.faction.index),this.claims(e,t),Cn.isFaction(e)&&(null===(n=this.faction)||void 0===n?void 0:n.index)!==r&&(Yt.markTerritory(this.hex,{graphics:Yt.graphics.territoryFills,lineOffset:1,fill:!0}),Yt.markTerritory(this.hex,{graphics:Yt.graphics.territoryLines,lineOffset:.97,fill:!1}))}}},{key:"isValidImprovement",value:function(e){return jt(St(Ct,this),e,St(Ft,this))}},{key:"setImprovement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"destroy"===e?(Et(At,this,void 0),Et(Ft,this,{key:""}),!0):!!jt(St(Ct,this),e,St(Ft,this))&&(Et(At,this,wt(wt(wt({},le.improvements[e]),le.improvements[e].terrains[St(Ct,this).terrain.terrain]),{},{key:e})),t instanceof Cn&&(this.claimTerritory(t,10),St(At,this).faction=t),St(Ft,this).key=e,!0)}}],[{key:"isTile",value:function(t){return t instanceof e}}])}();function Lt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.city,n=(e.faction,e.hex),r=e.tile,i=e.type,o=function(){var e=[];for(var t in le.LaborerNames){var n=Math.random();for(var r in le.LaborerNames[t])if(n<Number.parseFloat(r)){e.push(le.LaborerNames[t][r]);break}}return e.join(" ")}();Vn.isCity(t)&&Object.defineProperty(this,"city",{enumerable:!0,get:function(){return t}}),(ar(n)||ar(null==r?void 0:r.hex))&&Object.defineProperty(this,"hex",{enumerable:!0,get:function(){return n||(null==r?void 0:r.hex)}}),(qt.isTile(r)||qt.isTile(null==n?void 0:n.tile))&&Object.defineProperty(this,"tile",{enumerable:!0,get:function(){return r||(null==n?void 0:n.tile)}}),Object.defineProperties(this,{name:{enumerable:!0,get:function(){return o}},type:{enumerable:!0,get:function(){return i}}})}Object.assign(Lt.prototype,{assignTile:function(e){if(!qt.isTile(e))throw new TypeError("Laborer.assignTile expects to be passed object instance of Tile!");this.tile=e}}),Lt.FOOD_CONSUMPTION=2,Lt.isLaborer=function(e){return e instanceof Lt};const Nt=Lt;function Ht(e){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(e)}function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Dt(r.key),r)}}function Dt(e){var t=function(e){if("object"!=Ht(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ht(t)?t:t+""}function _t(e){var t="function"==typeof Map?new Map:void 0;return _t=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(Vt())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&zt(i,n.prototype),i}(e,arguments,Gt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),zt(n,e)},_t(e)}function Vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Vt=function(){return!!e})()}function zt(e,t){return zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zt(e,t)}function Gt(e){return Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gt(e)}var Bt=[],Kt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=Gt(t),function(e,t){if(t&&("object"==Ht(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Vt()?Reflect.construct(t,n||[],Gt(e).constructor):t.apply(e,n))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zt(e,t)}(t,e),function(e,t){return t&&Rt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.dispatchEvent(new CustomEvent(e,{detail:t}))}}])}(_t(EventTarget)),Yt={events:new Kt,players:[],turn:0,activeUnit:null,currentPlayer:null,intCurrentPlayer:null,graphics:{},scenes:{},startRound:function(){var e=this;this.players.forEach(function(e){e.units=e.units}),sr.forEach(function(t){if(e.nations.forEach(function(e){t.tile.nation===e?t.tile.claimTerritory(e,1):t.tile.claims(e)>0&&t.tile.claimTerritory(e,-1)}),e.players.forEach(function(e){t.tile.faction===e?t.tile.claimTerritory(e,1):t.tile.claims(e)>0&&t.tile.claimTerritory(e,-1)}),t.tile.food=0,t.tile.laborers.size>0){var n=0;if(n+=t.terrain.food||0,(n+=t.tile.improvement.food||0)>0){var r=new vt("food",{num:n,hex:t});Bt.push(r),e.events.emit("goods-created",{goods:r})}}}),sr.forEach(function(e){Vn.isCity(e.city)&&(e.city,sr.traverse(te({start:[e.q,e.r],radius:2})).forEach(function(e){}))}),this.turn++,this.events.emit("start-round"),this.startTurn(0)},startTurn:function(e){if(!Number.isFinite(e))throw new TypeError("Unknown player ".concat(e));if(this.currentPlayer=this.players[e],!(this.currentPlayer instanceof Cn))throw new TypeError("Player ".concat(e," is not a Faction Object"));this.intCurrentPlayer=e,this.currentPlayer.units.forEach(function(e){e.prepareForNewTurn()}),this.currentPlayer.activateUnit(0)},markTerritory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.graphics,r=void 0===n?this.graphics.territoryLines:n,i=t.lineOffset,o=void 0===i?.97:i,a=t.offsetX,s=void 0===a?0:a,u=t.offsetY,c=void 0===u?0:u,l=t.fill,f=void 0!==l&&l,h=t.lineWidth,y=void 0===h?5:h;(ar(e)?[e]:sr).forEach(function(e){if(qt.isTile(e.tile)&&e.tile.faction instanceof Cn){!1===f?r.lineStyle(y,e.tile.faction.color):r.fillStyle(e.tile.faction.color),r.beginPath();var t=function(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ut(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ut(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.corners.map(function(t){return ye(t,e,o)})),n=t[0],i=t.slice(1);r.moveTo(n.x+s,n.y+c),i.forEach(function(e){var t=e.x,n=e.y;r.lineTo(t+s,n+c)}),r.closePath()[!1===f?"strokePath":"fillPath"]()}})},endTurn:function(){console.log("Sam, endTurn!"),this.intCurrentPlayer++,this.intCurrentPlayer>=this.players.length?this.endRound():this.startTurn(this.intCurrentPlayer)},endRound:function(){var e=this;console.log("Sam, endRound!"),this.events.emit("end-round"),this.betweenRounds=!0;var t=[];sr.forEach(function(e){Vn.isCity(e.city)&&t.push(e)}),Bt.forEach(function(e,n){e.faction;var r=e.hex,i=e.num;if("food"===e.goodsType)if(i<=0)e.destroy();else{if(r.tile.laborers.size>0&&r.tile.food<r.tile.laborers.size*Nt.FOOD_CONSUMPTION){var o=Math.max(0,r.tile.laborers.size*Nt.FOOD_CONSUMPTION-r.tile.food),a=Math.min(o,i);if(e.num=i-=a,r.tile.food+=a,i<=0)return void e.destroy()}var s=null,u=1/0;t.forEach(function(e){var t=sr.distance(r,e);t<u&&(s=e,u=t)}),ar(s)&&Vn.isCity(s.city)&&null!==e.setPath(s)&&(e.prepareForNewTurn(),e.moveOneTurn()),++e.rounds}}),sr.forEach(function(e){e.tile.laborers.size>0&&(e.tile.food,e.tile.laborers.size,Nt.FOOD_CONSUMPTION),e.tile.food-=e.tile.laborers.size*Nt.FOOD_CONSUMPTION}),Promise.all([]).then(function(){e.betweenRounds=!1,e.startRound()})}};function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xt(Object(n),!0).forEach(function(t){$t(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $t(e,t,n){return(t=tn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zt(e){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(e)}function en(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,tn(r.key),r)}}function tn(e){var t=function(e){if("object"!=Zt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Zt(t)?t:t+""}function nn(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(nn=function(){return!!e})()}function rn(e,t,n,r){var i=on(an(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function on(){return on="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=an(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},on.apply(null,arguments)}function an(e){return an=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},an(e)}function sn(e,t){return sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sn(e,t)}function un(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function cn(e,t){return e.get(fn(e,t))}function ln(e,t,n){return e.set(fn(e,t),n),n}function fn(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function hn(e,t,n){switch(e){case"u":n%2==0&&t--,n--;break;case"i":t--;break;case"o":n%2==0&&t--,n++;break;case"j":n%2==1&&t++,n--;break;case"k":t++;break;case"l":n%2==1&&t++,n++;break;default:throw new TypeError("Unknown action tile '".concat(e,"'"))}return[t,n]}Yt.events.on("end-turn",Yt.endTurn.bind(Yt));var yn=new WeakMap,dn=new WeakMap,vn=new WeakMap,pn=function(e){function t(e,n){var r,i,o=n.hex,a=n.faction;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!Cn.isFaction(a))throw new TypeError("Unit expects to be assigned a Faction!");var s=null!==(r=le.units[e])&&void 0!==r?r:function(e){throw new TypeError(e)}("Unknown unit '".concat(e,"'"));return un(i=function(e,t,n){return t=an(t),function(e,t){if(t&&("object"==Zt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,nn()?Reflect.construct(t,n||[],an(e).constructor):t.apply(e,n))}(this,t,[{base:s,hex:o,faction:a}]),yn,void 0),un(i,dn,void 0),un(i,vn,void 0),ln(dn,i,s.sightDistance||1),ln(vn,i,e),Yt.events.emit("unit-created",{unit:i}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sn(e,t)}(t,e),function(e,t,n){return t&&en(e.prototype,t),n&&en(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"sightDistance",get:function(){return cn(dn,this)}},{key:"unitType",get:function(){return cn(vn,this)}},{key:"deactivate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];rn(t,"deactivate",this,3)([e]),Yt.activeUnit=null,Yt.events.emit("unit-deactivated",{unit:this}),this.faction.checkEndTurn()}},{key:"activate",value:function(){var e,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];rn(t,"activate",this,3)([n]),Yt.activeUnit=this,"object"===Zt(null!==(e=cn(yn,this))&&void 0!==e&&e)&&cn(yn,this).params.hex===this.hex&&(xr.handle(cn(yn,this).action,Jt({unit:this},cn(yn,this).params)),ln(yn,this,null)),0===this.faction.index?Yt.events.emit("unit-activated",{unit:this}):this.deactivate(!0)}},{key:"destroy",value:function(){this.deactivate(!0),rn(t,"destroy",this,3)([]),Yt.events.emit("unit-destroyed",{unit:this})}},{key:"doAction",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sr;try{var r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Qt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(hn(e,this.row,this.col),2),i=r[0],o=r[1],a=n.getHex({row:i,col:o});rn(t,"setPath",this,3)([a,n]),rn(t,"moveOneStep",this,3)([])}catch(e){}}},{key:"setAction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sr;if("string"!=typeof e)throw new TypeError("Unit.setAction expects action to be a string!");if(ar(t.hex)&&t.hex===this.hex&&xr.handle(e,Jt({unit:this},t)),ar(t.hex)&&t.hex!==this.hex)return ln(yn,this,{action:e,params:t}),void this.setPathAndMove(t.hex,n)}}],[{key:"isUnit",value:function(e){return e instanceof t}},{key:"isActivatableUnit",value:function(e){return t.isUnit(e)&&!1===e.deleted}},{key:"isMovableUnit",value:function(e){return t.isActivatableUnit(e)&&e.moves>0}}])}(Ke);function mn(e){return mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mn(e)}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,gn(r.key),r)}}function gn(e){var t=function(e){if("object"!=mn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=mn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==mn(t)?t:t+""}function wn(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function xn(e,t){return e.get(On(e,t))}function kn(e,t,n){return e.set(On(e,t),n),n}function On(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}pn.isUnit;var Tn=null,Sn=new WeakMap,En=new WeakMap,Pn=new WeakMap,jn=new WeakMap,Mn=new WeakMap,Cn=function(){function e(t){var n,r=this,i=t.index;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),wn(this,Sn,void 0),wn(this,En,void 0),wn(this,Pn,0),wn(this,jn,void 0),wn(this,Mn,[]),!Number.isInteger(i)||i<0)throw new TypeError("Faction.constructor expects index to be a nonnegative integer!");kn(Sn,this,function(e){var t;return null!==(t=[3329330,16711680,255][e])&&void 0!==t?t:11184810}(i)),kn(En,this,i),kn(jn,this,null===(n=le)||void 0===n?void 0:n.FactionNames[i]),Yt.events.on("goods-moved",function(e){var t=e.detail,n=t.goods,i=t.promise;n.faction===r&&Vn.isCity(n.hex.city)&&i.then(function(){console.log("Sam, Faction received",n.num,"goods for",le.ResourceValues[n.goodsType],"each"),r.money+=le.ResourceValues[n.goodsType]*n.num,console.log("Sam, Faction new money total:",r.money)})}),Yt.events.on("unit-moved",function(e){e.detail.faction!==r&&e.detail.unit.faction!==r||e.detail.promise.then(r.checkEndTurn.bind(r))})}return function(e,t,n){return t&&bn(e.prototype,t),n&&bn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"color",get:function(){return xn(Sn,this)}},{key:"index",get:function(){return xn(En,this)}},{key:"name",get:function(){return xn(jn,this)}},{key:"nation",get:function(){return Yt.nations[0]}},{key:"money",get:function(){return xn(Pn,this)},set:function(e){if(!Number.isFinite(e)||e<0)throw new TypeError("Faction.money expects to be assigned a nonnegative number!");kn(Pn,this,e)}},{key:"activeUnit",get:function(){if(Number.isInteger(Tn)&&Tn>=0&&Tn<=units.length)return units[Tn]},set:function(e){if(null!==e){if(!Number.isInteger(e)||e<0)throw new TypeError("Faction.activeUnit expects to be assigned a nonnegative number!");Tn=e%xn(Mn,this).length}else Tn=null}},{key:"units",get:function(){return xn(Mn,this)},set:function(e){if(!Array.isArray(e))throw new TypeError("Faction.units expects to be assigned an Array!");kn(Mn,this,e.filter(pn.isActivatableUnit))}},{key:"addUnit",value:function(e,t){xn(Mn,this).push(new pn(e,{hex:t,faction:this}))}},{key:"checkEndTurn",value:function(){this.activateNext()||Yt.events.emit("end-turn",{faction:this})}},{key:"activateUnit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tn;return 0===xn(Mn,this).length?(Yt.events.emit("end-turn",{faction:this}),!1):!!pn.isActivatableUnit(xn(Mn,this)[e])&&(xn(Mn,this)[e].activate(),Tn=e,!0)}},{key:"activateNext",value:function(){var e=function(e,t){for(var n=0;n<e.length;n++){var r=(t+1+n)%e.length;if(pn.isMovableUnit(e[r]))return e[r]}return!1}(xn(Mn,this),Tn);return!!pn.isMovableUnit(e)&&(Tn=xn(Mn,this).indexOf(e),e.activate(),!0)}}],[{key:"isFaction",value:function(t){return t instanceof e}}])}();function An(e){return An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},An(e)}function Fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,In(r.key),r)}}function In(e){var t=function(e){if("object"!=An(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=An(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==An(t)?t:t+""}function Wn(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function qn(e,t){return e.get(Nn(e,t))}function Ln(e,t,n){return e.set(Nn(e,t),n),n}function Nn(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var Hn=new WeakMap,Un=new WeakMap,Rn=new WeakMap,Dn=new WeakMap,_n=new WeakMap,Vn=function(){function e(t){var n=this,r=t.hex,i=t.nation,o=t.Grid,a=void 0===o?sr:o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Wn(this,Hn,void 0),Wn(this,Un,void 0),Wn(this,Rn,void 0),Wn(this,Dn,[]),Wn(this,_n,0),!mt.isNation(i))throw new TypeError("City expects to be assigned object instance of Nation!");if(Ln(Rn,this,i),!ar(r))throw new TypeError("City expects to be assigned object instance of Hex!");Ln(Hn,this,r),r.tile.setImprovement("destroy"),r.city=this,a.traverse(te({start:[r.q,r.r],radius:1})).forEach(function(e){ar(e)&&e.tile.claimTerritory(i,100)}),a.traverse(Z({center:[r.q,r.r],radius:2})).forEach(function(e){ar(e)&&e.tile.claimTerritory(i,e.terrain.isWater?50:0)}),Ln(Un,this,new Te({hex:r,numUnits:6})),Yt.events.on("goods-moved",function(e){var t=e.detail,r=t.goods,i=t.promise;r.hex.city===n&&i.then(function(){Ln(_n,n,qn(_n,n)+r.num),n.processFood()})})}return function(e,t,n){return t&&Fn(e.prototype,t),n&&Fn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"processFood",value:function(){do{var e,t;if(qn(Dn,this).length<=0)return;console.log("Sam, in processFood");var n=qn(Dn,this)[0],r=n.faction,i=n.unitType,o=(null===(e=le.units)||void 0===e||null===(e=e[i])||void 0===e||null===(e=e.productionCosts)||void 0===e||null===(e=e.removeFromQueue)||void 0===e?void 0:e.food)||0,a=(null===(t=le.units)||void 0===t||null===(t=t[i])||void 0===t||null===(t=t.productionCosts)||void 0===t||null===(t=t.removeFromQueue)||void 0===t?void 0:t.money)||0;if(r.money<a){qn(Dn,this).shift();break}if(qn(_n,this)<o)break;Ln(_n,this,qn(_n,this)-o),r.money-=a;var s=qn(Dn,this).shift();s.faction.addUnit(s.unitType,qn(Hn,this))}while(qn(_n,this)>0&&qn(Dn,this).length>0)}},{key:"hex",get:function(){return qn(Hn,this)}},{key:"housing",get:function(){return qn(Un,this).numUnits}},{key:"laborers",get:function(){return qn(Un,this).laborers},set:function(e){qn(Un,this).laborers=e}},{key:"nation",get:function(){return qn(Rn,this)}},{key:"queue",get:function(){return qn(Dn,this)}},{key:"addToQueue",value:function(e){var t=e.faction,n=e.unitType;if(!Cn.isFaction(t))throw new TypeError("City.addToQueue expects to be assigned object instance of Faction!");n in le.units?qn(Dn,this).push({unitType:n,faction:t}):console.warn("City production queue: Unknown unit key ".concat(n))}}],[{key:"isCity",value:function(t){return t instanceof e}}])}();function zn(e){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zn(e)}function Gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Bn(r.key),r)}}function Bn(e){var t=function(e){if("object"!=zn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=zn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==zn(t)?t:t+""}var Kn={visible:16777215,explored:8355711,unexplored:0},Yn=new Map,Qn=function(){return function(e,t,n){return n&&Gn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},0,[{key:"startTileFogState",value:function(e,t){if(le.fogOfWar){if(!Cn.isFaction(e))throw new TypeError("FogOfWar.startTileFogState expects to be assigned object instance of Faction!");if(!ar(t))throw new TypeError("FogOfWar.startTileFogState expects to be assigned object instance of Hex!");Yn.has(e)||Yn.set(e,new Map);var n,r=Yn.get(e);r.set(t,"unexplored"),0===e.index&&(null===(n=t.sprite)||void 0===n||n.setTint(Kn[r.get(t)]).setDepth(10))}}},{key:"exploreTileForFaction",value:function(e,t){if(le.fogOfWar){if(!Cn.isFaction(e))throw new TypeError("FogOfWar.exploreTileForFaction expects to be assigned object instance of Faction!");if(!ar(t))throw new TypeError("FogOfWar.exploreTileForFaction expects to be assigned object instance of Hex!");Yn.has(e)||Yn.set(e,new Map);var n,r=Yn.get(e);r.set(t,"explored"),0===e.index&&(null===(n=t.sprite)||void 0===n||n.setTint(Kn[r.get(t)]).setDepth(1).setInteractive(new Phaser.Geom.Polygon(t.corners),Phaser.Geom.Polygon.Contains),Yt.events.emit("hex-hidden",{hex:t}))}}},{key:"viewTileForFaction",value:function(e,t){if(le.fogOfWar){if(!Cn.isFaction(e))throw new TypeError("FogOfWar expects to be assigned object instance of Faction!");if(!ar(t))throw new TypeError("FogOfWar expects to be assigned object instance of Hex!");Yn.has(e)||Yn.set(e,new Map);var n,r=Yn.get(e);r.set(t,"visible"),0===e.index&&(null===(n=t.sprite)||void 0===n||n.setTint(Kn[r.get(t)]).setDepth(1).setInteractive(new Phaser.Geom.Polygon(t.corners),Phaser.Geom.Polygon.Contains),Yt.events.emit("hex-visible",{hex:t}))}}},{key:"isHexVisible",value:function(e,t){if(!le.fogOfWar)return!0;if(!Cn.isFaction(e))throw new TypeError("FogOfWar.isHexVisible expects to be assigned object instance of Faction!");if(!ar(t))throw new TypeError("FogOfWar.isHexVisible expects to be assigned object instance of Hex!");return!!ar(t)&&!!Yn.has(e)&&"visible"===Yn.get(e).get(t)}},{key:"isHexExplored",value:function(e,t){if(!le.fogOfWar)return!0;if(!Cn.isFaction(e))throw new TypeError("FogOfWar.isHexExplored expects to be assigned object instance of Faction!");if(!ar(t))throw new TypeError("FogOfWar.isHexExplored expects to be assigned object instance of Hex!");return!!ar(t)&&!!Yn.has(e)&&"unexplored"!==Yn.get(e).get(t)}}])}();function Xn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sr;e.forEach(function(e){e.tile.faction===Yt.players[0]&&Qn.viewTileForFaction(Yt.players[0],e)}),Yt.players[0].units.forEach(function(t){t.deleted||e.traverse(te({start:t.hex,radius:t.sightDistance})).forEach(function(e){ar(e)&&Qn.viewTileForFaction(t.faction,e)})})}function Jn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.hex,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sr;0===e.faction.index&&n.traverse(te({start:t,radius:e.sightDistance})).forEach(function(t){ar(t)&&Qn.exploreTileForFaction(e.faction,t)})}Yt.events.on("unit-destroyed",function(e){Jn(e.detail.unit),Xn()}),Yt.events.on("unit-moving",function(e){var t=e.detail,n=t.unit,r=t.priorHex;0===n.faction.index&&(Jn(n,r),Xn())});var $n=new Map;function Zn(e){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zn(e)}function er(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(er=function(){return!!e})()}function tr(e){return tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tr(e)}function nr(e,t){return nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nr(e,t)}function rr(e,t,n){return(t=ir(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ir(e){var t=function(e){if("object"!=Zn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Zn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Zn(t)?t:t+""}var or=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return rr(e=function(e,t,n){return t=tr(t),function(e,t){if(t&&("object"==Zn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,er()?Reflect.construct(t,n||[],tr(e).constructor):t.apply(e,n))}(this,t,[].concat(r)),"f_cost",void 0),rr(e,"h_cost",void 0),rr(e,"g_cost",void 0),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nr(e,t)}(t,e),function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(t)}(F({dimensions:100,orientation:P.FLAT,origin:"topLeft"}));function ar(e){return e instanceof j}var sr=new oe(or,X({width:15,height:6}));function ur(e,t){if(!ar(e))return!1;if(!Ke.isInstanceofMovable(t))return!1;if(!Qn.isHexExplored(t.faction,e))return!1;if(e.terrain.isWater&&!t.moveOnWater)return Number.isInteger(t.movementCosts[e.terrain.terrain]);if(pn.isUnit(t)){if(Vn.isCity(e.city)&&e.city.nation!==t.faction.nation&&(!t.attack||!t.attackCities))return!1}else vt.isGoods(t);var n=cr(t,e);return!!Number.isFinite(n)&&n<=t.baseMovementPoints}function cr(e,t){var n,r,i;return arguments.length>2&&void 0!==arguments[2]||e.hex,ar(t)&&Ke.isInstanceofMovable(e)?t.terrain.isWater&&!e.moveOnWater?null!==(i=e.movementCosts[t.terrain.terrain])&&void 0!==i?i:1/0:null!==(n=null!==(r=e.movementCosts[t.terrain.terrain])&&void 0!==r?r:t.terrain.movementCost)&&void 0!==n?n:1/0:1/0}function lr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fr(e){return fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fr(e)}function hr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vr(r.key),r)}}function dr(e,t,n){return t&&yr(e.prototype,t),n&&yr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function vr(e){var t=function(e){if("object"!=fr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=fr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==fr(t)?t:t+""}var pr=function(){return dr(function e(t){var n=this;hr(this,e),["command","execute","isValid","label"].forEach(function(e){e in t&&(n["#".concat(e)]=t[e],delete t[e])}),Object.assign(this,t)},[{key:"isValid",value:function(e){if("string"==typeof e.menu&&!this.showIn.includes(e.menu))return!1;if(!0===this["#isValid"])return!0;if(Array.isArray(this.unitTypes)&&(!pn.isUnit(e.unit)||!this.unitTypes.includes(e.unit.unitType)))return!1;var t=br[this["#isValid"]];return"function"!=typeof t||t(e)}},{key:"execute",value:function(e){if(!this.isValid(e))return!1;var t=gr[this["#execute"]];if("function"==typeof t)return Promise.try(function(){Yt.events.emit("doing-action")}).then(function(){t(e)});var n=gr[this["#command"]];if("function"==typeof n)return Promise.try(function(){n(e)});console.warn("No executor for action ".concat(this.key))}},{key:"label",get:function(){var e=wr[this["#label"]];return"function"==typeof e?e(context):this["#label"]}}])}(),mr=new Map;le.actions.forEach(function(e){var t=new pr(e);mr.set(t.key,t)});var br={currentPlayerTurn:function(){return Yt.currentPlayer===Yt.players[0]},hexTileValid:function(e){var t=e.hex;return ar(t)&&qt.isTile(t.tile)},isCityTile:function(e){var t=e.hex;return Vn.isCity(t.city)},isFarmBuildable:function(e){var t=e.hex,n=e.unit;return!!br.hexTileValid({hex:t})&&"farmer"===n.unitType&&t.tile.isValidImprovement("farm")},isHexControlled:function(e){var t=e.hex,n=e.faction;return t.tile.faction===n},isLegalMove:function(e){var t=e.hex,n=e.unit;return t!==n.hex&&ur(t,n)}},gr={buildFarm:function(e){var t=e.unit,n=e.hex;n===t.hex?(n.tile.setImprovement("farm",t.faction),n.tile.laborers=new Nt({hex:n,faction:t.faction,type:"farmer"}),t.destroy()):t.setAction("build-farm",{hex:n})},centerMap:function(){Yt.events.emit("center-map")},endTurn:function(){Yt.events.emit("end-turn")},skip:function(e){e.unit.deactivate(!0)},startCityView:function(e){var t=e.hex;Yt.scenes.start("city-view",{hex:t})},startMoveTo:function(e){var t,n=e.unit,r=e.hex;null!=n||(n=Yt.activeUnit),null!=r||(r=null!==(t=Yt.activeTile)&&void 0!==t?t:n.hex),n.setPath(r)&&n.moveOneTurn()},startTileView:function(e){var t=e.hex;Yt.scenes.start("tile-view",{hex:t})},wait:function(e){e.unit.deactivate()}},wr={},xr=function(){return dr(function e(){hr(this,e)},null,[{key:"handle",value:function(e,t){var n=mr.get(e);return n instanceof pr&&!!n.isValid(t)&&(n.execute(t),!0)}},{key:"getAvailableActions",value:function(e){return function(e){return function(e){if(Array.isArray(e))return lr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return lr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(mr.values()).filter(function(t){return t.isValid(e)})}}])}();function kr(e){return kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kr(e)}function Or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tr(r.key),r)}}function Tr(e){var t=function(e){if("object"!=kr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==kr(t)?t:t+""}function Sr(e,t,n){Er(e,t),t.set(e,n)}function Er(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Pr(e,t){return e.get(Mr(e,t))}function jr(e,t,n){return e.set(Mr(e,t),n),n}function Mr(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Yt.events.on("key-pressed",function(e){var t,n=Yt.activeUnit;pn.isUnit(n)&&xr.handle(e.detail,{unit:n,hex:null!==(t=Yt.activeTile)&&void 0!==t?t:n.hex,faction:n.faction})});var Cr=new WeakMap,Ar=new WeakMap,Fr=new WeakMap,Ir=new WeakMap,Wr=new WeakSet,qr=function(){return function(e,t){return t&&Or(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){Er(e,t),t.add(e)}(this,Wr),Sr(this,Cr,void 0),Sr(this,Ar,void 0),Sr(this,Fr,void 0),Sr(this,Ir,void 0),!(t instanceof globalThis.Phaser.Scene))throw new Error("InputManager requires a Phaser.Scene instance");switch(jr(Ar,this,t),jr(Ir,this,t.input.keyboard.addKey(globalThis.Phaser.Input.Keyboard.KeyCodes.SHIFT)),jr(Fr,this,Pr(Ar,this).scene.key)){case"city-view":Mr(Wr,this,Lr).call(this);break;case"tile-view":Mr(Wr,this,Nr).call(this);break;case"mainGameScene":Mr(Wr,this,Hr).call(this)}},[{key:"disableKeyboardInput",value:function(){var e,t=null===(e=Pr(Ar,this).input)||void 0===e?void 0:e.keyboard;"object"===kr(null!=t&&t)&&(t.enabled=!1,t.removeCapture("SPACE"),t.removeCapture("UP"),t.removeCapture("DOWN"),t.removeCapture("LEFT"),t.removeCapture("RIGHT"))}},{key:"enableKeyboardInput",value:function(){var e,t=null===(e=Pr(Ar,this).input)||void 0===e?void 0:e.keyboard;"object"===kr(null!=t&&t)&&(t.enabled=!0,"mainGameScene"===Pr(Fr,this))&&jr(Cr,this,t.createCursorKeys())}},{key:"update",value:function(){if("mainGameScene"===Pr(Fr,this)){var e=Pr(Ar,this).cameras.main,t=Pr(Ir,this).isDown?25:5;Pr(Cr,this).left.isDown?e.scrollX-=t:Pr(Cr,this).right.isDown&&(e.scrollX+=t),Pr(Cr,this).up.isDown?e.scrollY-=t:Pr(Cr,this).down.isDown&&(e.scrollY+=t)}}},{key:"destroy",value:function(){}}])}();function Lr(){var e=this;Pr(Ar,this).input.keyboard.on("keydown",function(t){"Escape"===t.key&&Pr(Ar,e).scene.stop("city-view")})}function Nr(){var e=this;document.querySelector("#tile-view").addEventListener("contextmenu",function(e){e.preventDefault()}),Pr(Ar,this).input.keyboard.on("keydown",function(t){"Escape"===t.key&&Pr(Ar,e).scene.stop("tile-view")}),this.enableKeyboardInput()}function Hr(){var e,t,n,r=this;Yt.domContainer.addEventListener("contextmenu",function(e){e.preventDefault()}),Pr(Ar,this).input.manager.canvas.addEventListener("contextmenu",function(e){e.preventDefault()}),null===(e=document.querySelector("#zoom"))||void 0===e||e.addEventListener("contextmenu",function(e){e.preventDefault()}),null===(t=document.querySelector("#zoom-in"))||void 0===t||t.addEventListener("click",function(e){e.currentTarget.disabled||Yt.events.emit("zoom-in")}),null===(n=document.querySelector("#zoom-out"))||void 0===n||n.addEventListener("click",function(e){e.currentTarget.disabled||Yt.events.emit("zoom-out")}),Pr(Ar,this).input.keyboard.on("keydown",function(e){if(!(e.ctrlKey&&["r","R","1","2","3","4","5","6","7","8","9"].includes(e.key)||e.ctrlKey&&"I"===e.key)){switch(e.preventDefault(),e.key){case"`":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case"q":case"e":case"r":case"t":case"y":case"u":case"i":case"o":case"p":case"a":case"d":case"f":case"g":case"h":case"j":case"k":case"l":case"z":case"x":case"v":case"b":case"n":case"F1":case"F2":case"F4":case"F5":case"F3":break;case"-":Yt.events.emit("zoom-out");break;case"=":Yt.events.emit("zoom-in");break;case"w":return void Yt.events.emit("key-pressed","wait");case"s":return void Yt.events.emit("key-pressed","skip");case"F":e.altKey||e.ctrlKey||Yt.events.emit("key-pressed","build-farm");break;case"c":e.altKey||e.ctrlKey||Yt.events.emit("center-map");break;case"m":Yt.events.emit("key-pressed","move");break;case"Escape":Yt.events.emit("esc-pressed")}if(["u","i","o","j","k","l"].includes(e.key)){if(!pn.isMovableUnit(Yt.activeUnit))return;Yt.activeUnit.doAction(e.key)}}});var i=!1,o={x:0,y:0},a={x:0,y:0},s=4;Pr(Ar,this).input.on("pointerdown",function(e){switch(o.x=e.x,o.y=e.y,a.x=Pr(Ar,r).cameras.main.scrollX,a.y=Pr(Ar,r).cameras.main.scrollY,i=!1,e.pointerType){case"touch":s=10;break;case"pen":s=8;break;default:s=4}}),Pr(Ar,this).input.on("pointermove",function(e){if(e.isDown){var t=e.x-o.x,n=e.y-o.y;if(!i&&(Math.abs(t)>s||Math.abs(n)>s)&&(i=!0),i){var u=Pr(Ar,r).cameras.main.zoom||1;Pr(Ar,r).cameras.main.setScroll(a.x-t/u,a.y-n/u)}}}),Pr(Ar,this).input.on("pointerup",function(e){if(!i){var t=sr.pointToHex({x:e.worldX,y:e.worldY});ar(t)&&Yt.events.emit("hex-clicked",{hex:t})}i=!1}),this.enableKeyboardInput()}var Ur=null,Rr=null;function Dr(){Rr&&(Rr.setAttribute("hidden","true"),Rr.style.zIndex=-1,Array.from(Rr.children).forEach(function(e){e.hasAttribute("id")&&(e.innerHTML="")}))}const _r={key:"city-view",preload:function(){},create:function(e){var t=this;if(ar(e.hex)&&qt.isTile(e.hex.tile)&&Vn.isCity(e.hex.city)){this.scene.pause("mainGameScene"),this.scene.moveAbove("mainControls","city-view");var n=he();Ur=e.hex.city,null!=Rr||(Rr=document.getElementById("city-view"));var r=Rr.querySelector("#production-queue");r.innerHTML="<h2>Production Queue</h2>";var i=document.createElement("select"),o=document.createElement("option");o.text="-- Select Unit Type --",o.value="",i.appendChild(o),Object.keys(le.units).forEach(function(e){var t=document.createElement("option");t.value=e,t.text=le.units[e].name,i.appendChild(t)}),r.appendChild(i);var a=document.createElement("button");a.innerText="Add to Queue",a.addEventListener("click",function(){var e=i.options[i.selectedIndex].value;if(e in le.units){var t=le.units[e];try{Yt.currentPlayer.money-=t.productionCosts.addToQueue.money||0}catch(e){return}Ur.addToQueue({faction:Yt.currentPlayer,unitType:e})}else console.error("City View: Unknown unit type selected: ".concat(e))}),a.disabled=!0,r.appendChild(a),i.addEventListener("change",function(){var e,t=i.options[i.selectedIndex].value;a.disabled=Yt.currentPlayer.money<((null===(e=le.units)||void 0===e||null===(e=e[t])||void 0===e||null===(e=e.productionCosts)||void 0===e||null===(e=e.addToQueue)||void 0===e?void 0:e.money)||0)||""===t}),r.appendChild(document.createElement("ul")),Rr.removeAttribute("hidden"),Rr.style.zIndex=1;var s=this.add.graphics({x:0,y:0}).setDepth(0);s.fillStyle(0,.5),s.fillRect(0,0,n.width,n.height);var u=this.add.graphics({x:0,y:0}).setDepth(1),c=Rr.querySelector(".btn-close");c instanceof Element&&c.addEventListener("click",function(){t.scene.stop("city-view")});var l=[e.hex.x,e.hex.y],f=l[0],h=l[1],y=Math.min(n.height,n.width)/7/fe,d=n.width/2,v=n.height/3;sr.traverse(te({start:[e.hex.q,e.hex.r],radius:2})).forEach(function(e){var n={x:(e.x-f)*y+d,y:(e.y-h)*y+v},r=t.add.image(n.x,n.y,"tile.".concat(e.terrain.terrain)).setDepth(1);if(r.scaleX=y,r.scaleY=y,Yt.markTerritory(e,{offsetX:0-e.x+d+(e.x-f)*y,offsetY:0-e.y+v+(e.y-h)*y,graphics:u.setDepth(2),lineOffset:.95*y}),e.tile.laborers.size>0){var i=fe*y;t.add.text(n.x-i/2,n.y+i/4,"Food: ".concat((e.terrain.food||0)+(e.tile.improvement.food||0)),{font:"14pt Trebuchet MS",align:"center",color:"white",stroke:"black",strokeThickness:7,fixedWidth:i}).setDepth(3)}}),this.inputManager=new qr(this),this.events.on("sleep",function(){Dr(),t.scene.wake("mainGameScene")}).on("shutdown",function(){Dr(),t.scene.wake("mainGameScene")})}else this.scene.resume("mainGameScene")},update:function(){var e=document.querySelector("#production-queue > ul");e.querySelectorAll("li").length!==Ur.queue.length&&(e.innerHTML="",Ur.queue.forEach(function(t){var n=t.faction,r=t.unitType,i=document.createElement("li");i.innerText="".concat(n.name,": ").concat(le.units[r].name),e.appendChild(i)}))}};var Vr="mainControls",zr=new Map,Gr=new Map;const Br={key:Vr,autoStart:!0,preload:function(){this.load.image("coins","img/resources/coins.png")},create:function(){var e=Yt.graphics.mainControls=this.add.graphics({x:0,y:0}),t=15;zr.set("round",this.add.text(14,t,"Round ".concat(Yt.turn),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"white",stroke:"black",strokeThickness:5,maxLines:1})),zr.set("faction",this.add.text(14+zr.get("round").displayWidth+10,t+2,"",{fontFamily:"Trebuchet MS",fontSize:"26px",color:"white",stroke:"black",strokeThickness:5,maxLines:1})),t+=zr.get("faction").displayHeight+5,t-=15;var n=this.add.image(0,t,"coins").setDepth(2);n.setScale(32/n.width),n.x=20+n.displayWidth/2,n.y=t+=20+n.displayHeight/2,zr.set("money",this.add.text(n.x+n.displayWidth/2+6,n.y-n.displayHeight/2-4,Yt.players[0].money.toLocaleString("en-Us"),{fontFamily:"Trebuchet MS",fontSize:"28px",color:"gold",stroke:"black",strokeThickness:5,maxLines:1}).setLetterSpacing(1)),Gr.set("money",n),t+=zr.get("money").displayHeight,e.fillStyle(0,.5),e.fillRect(0,0,he().width,t),this.game.events.emit("scene-created-".concat(Vr))},update:function(){zr.forEach(function(e,t){switch(t){case"money":if(e.oldValue===Yt.players[0].money)return;return zr.get("money").setText(Yt.players[0].money.toLocaleString("en-Us")),void(e.oldValue=Yt.players[0].money);case"faction":if(!Yt.currentPlayer)return;if(e.oldValue===Yt.currentPlayer.name)return;return void zr.get("faction").setText("".concat(Yt.currentPlayer.name,"'s Turn")).setX(14+zr.get("round").displayWidth+10).setColor(0===Yt.currentPlayer.index?"goldenrod":"lightgrey")}})}};function Kr(e){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kr(e)}function Yr(e,t){if(e){if("string"==typeof e)return Qr(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qr(e,t):void 0}}function Qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Xr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Jr(r.key),r)}}function Jr(e){var t=function(e){if("object"!=Kr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Kr(t)?t:t+""}function $r(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function Zr(e,t){return e.get(ti(e,t))}function ei(e,t,n){return e.set(ti(e,t),n),n}function ti(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Yt.events.on("start-round",function(){zr.get("round").setText("Round ".concat(Yt.turn)).setColor("white")}),Yt.events.on("end-round",function(){zr.get("faction").setX(14+zr.get("round").displayWidth+10).setText("End of Round").setColor("lightgrey")});var ni=new Map,ri=new Map,ii=new WeakMap,oi=new WeakMap,ai=new WeakMap,si=new WeakMap,ui=new WeakMap,ci=new WeakMap,li=new WeakMap,fi=function(){return function(e,t){return t&&Xr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$r(this,ii,void 0),$r(this,oi,void 0),$r(this,ai,32),$r(this,si,void 0),$r(this,ui,void 0),$r(this,ci,!1),$r(this,li,void 0),ei(ii,this,t.hex),ei(oi,this,n),ei(ui,this,n.add.sprite(Zr(ii,this).x,Zr(ii,this).y,"goods.".concat(t.goodsType)).setDepth(20)),"food"===t.goodsType&&(ei(si,this,n.add.sprite(Zr(ii,this).x,Zr(ii,this).y-Zr(ai,this),"spoilage-timer").setDepth(20).setScale(.6).setTint(65280)),t.events.on("rounds-updated",function(e){console.log("Sam, rounds-updated called",e.detail.percentage);var t=e.detail.percentage;t<=20?Zr(si,r).setTintFill(16711680):t<=60?Zr(si,r).setTintFill(16776960):Zr(si,r).setTintFill(65280)})),ei(li,this,t.goodsType),this.setVisible(Qn.isHexVisible(Yt.players[0],t.hex)),t.events.on("destroyed",function(e){yi(t)})},[{key:"hex",get:function(){return Zr(ii,this)}},{key:"moving",get:function(){return Zr(ci,this)},set:function(e){if("boolean"!=typeof e)throw new TypeError("GoodsViewDetail.moving expects to be assigned a boolean!");"food"===Zr(li,this)&&Zr(si,this).setVisible(Zr(ui,this).visible&&!e),ei(ci,this,e)}},{key:"scene",get:function(){return Zr(oi,this)}},{key:"sprite",get:function(){return Zr(ui,this)}},{key:"x",get:function(){return Zr(ii,this).x},set:function(e){Zr(ui,this).setX(e),"food"===Zr(li,this)&&Zr(si,this).setX(e)}},{key:"y",get:function(){return Zr(ii,this).y},set:function(e){Zr(ui,this).setY(e),"food"===Zr(li,this)&&Zr(si,this).setY(e-Zr(ai,this))}},{key:"destroy",value:function(){Zr(ui,this).destroy(),"food"===Zr(li,this)&&Zr(si,this).destroy()}},{key:"setVisible",value:function(e){if("boolean"!=typeof e)throw new TypeError("GoodsViewDetail.setVisible expects a boolean!");Zr(ui,this).setVisible(e),"food"===Zr(li,this)&&Zr(si,this).setVisible(!Zr(ci,this)&&e)}},{key:"update",value:function(e){ar(e)&&ei(ii,this,e)}}])}();function hi(){ni.clear(),ri.entries().forEach(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||Yr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];n.moving||(n.deleted?yi(n):(ni.has(n.hex)||ni.set(n.hex,new Map),ni.get(n.hex).set(n,r)))}),ri.forEach(function(e,t){if(e.x!==t.hex.x||e.y!==t.hex.y){e.moving=!0;var n=function(e,t){var n=ri.get(e);if(n){var r=800,i=Qn.isHexVisible(Yt.players[0],t),o=Qn.isHexVisible(Yt.players[0],e.hex);return i||o?i&&!o?(n.setVisible(!0),new Promise(function(r){n.scene.tweens.add({targets:n.sprite,x:(e.hex.x+t.x)/2,y:(e.hex.y+t.y)/2,ease:"Quad.out",duration:400,yoyo:!1,onComplete:function(t){n.x=e.hex.x,n.y=e.hex.y,n.setVisible(!1),t.destroy(),r()}})})):!i&&o?new Promise(function(r){n.x=(e.hex.x+t.x)/2,n.y=(e.hex.y+t.y)/2,n.setVisible(!1),setTimeout(r,400)}).then(function(){return n.setVisible(!0),new Promise(function(t){n.scene.tweens.add({targets:n.sprite,x:e.hex.x,y:e.hex.y,ease:"Linear",duration:400,yoyo:!1,onComplete:function(e){e.destroy(),t()}})})}):new Promise(function(t){n.setVisible(!0),n.scene.tweens.add({targets:n.sprite,x:e.hex.x,y:e.hex.y,ease:"Quad.out",duration:r,yoyo:!1,onComplete:function(e){e.destroy(),t()}})}):(n.x=e.hex.x,n.y=e.hex.y,n.setVisible(!1),Promise.resolve())}}(t,e.hex);e.update(t.hex),n.then(function(){e.moving=!1,t.events.emit("moved",{promise:n}),Yt.events.emit("goods-moved",{goods:t,promise:n})})}}),ni.forEach(function(e,t){e.forEach(function(t,n){n.deleted&&e.delete(n)}),0!==e.size&&function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.width,u=void 0===s?1:s,c=n.cellWidth,l=void 0===c?32:c,f=n.cellHeight,h=void 0===f?32:f,y=0,d=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yr(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(a)throw i}}}}(e);try{for(d.s();!(t=d.n()).done;){var v=t.value,p=y%u,m=Math.floor(y/u),b=i+p*l+l/2,g=a+m*h+h/2;"function"==typeof v.setPosition?v.setPosition(b,g):(v.x=b,v.y=g),y++}}catch(e){d.e(e)}finally{d.f()}}(e.values().filter(function(e){return!e.moving}),{position:Phaser.Display.Align.CENTER,width:5,cellHeight:32,cellWidth:32,x:t.x-32*(e.size<5?e.size:5)/2,y:t.y-16*Math.ceil(e.size/5)})})}function yi(e){if(e.deleted&&ri.has(e)){var t=ri.get(e);t.setVisible(!1),t.destroy(),ri.delete(e)}}function di(e){return di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},di(e)}function vi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,pi(r.key),r)}}function pi(e){var t=function(e){if("object"!=di(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==di(t)?t:t+""}function mi(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function bi(e,t){return e.get(wi(e,t))}function gi(e,t,n){return e.set(wi(e,t),n),n}function wi(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Yt.events.on("hex-visible",function(e){var t=e.detail.hex;ri.forEach(function(e,n){e.hex===t&&e.setVisible(!0)})}),Yt.events.on("hex-hidden",function(e){var t=e.detail.hex;ri.forEach(function(e,n){e.hex===t&&e.setVisible(!1)})});var xi=new Map,ki=new WeakMap,Oi=new WeakMap,Ti=new WeakMap,Si=function(){return function(e,t){return t&&vi(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),mi(this,ki,void 0),mi(this,Oi,void 0),mi(this,Ti,void 0),gi(ki,this,t.hex),gi(Oi,this,n),gi(Ti,this,n.add.sprite(bi(ki,this).x,bi(ki,this).y+-30,"unit.".concat(t.unitType)).setTint(3684408).setDepth(12)),bi(Ti,this).setScale(110/bi(Ti,this).width)},[{key:"hex",get:function(){return bi(ki,this)}},{key:"scene",get:function(){return bi(Oi,this)}},{key:"sprite",get:function(){return bi(Ti,this)}},{key:"x",get:function(){return bi(ki,this).x}},{key:"y",get:function(){return bi(ki,this).y}},{key:"update",value:function(e){gi(ki,this,e)}}])}();function Ei(e){if(xi.has(e)){var t=xi.get(e);t.sprite.setVisible(!1),t.sprite.destroy(),xi.delete(e)}}function Pi(e){return Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pi(e)}function ji(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Mi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ji(Object(n),!0).forEach(function(t){Ci(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ji(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ci(e,t,n){return(t=function(e){var t=function(e){if("object"!=Pi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Pi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pi(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ai(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Fi(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fi(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Yt.events.on("unit-destroyed",function(e){Ei(e.detail.unit)});var Ii="mainGameScene",Wi=null,qi=[.4,.5,.7,1],Li={spriteOnActiveTile:null,spriteOnActiveUnit:null,shortcutKeys:[]};function Ni(){var e;if(void 0!==globalThis.Phaser){var t=he().offscreen;for(null===(e=Li.spriteOnActiveUnit)||void 0===e||e.setActive(!1).setPosition(t,t).setDepth(0);Li.shortcutKeys.length>0;)Li.shortcutKeys.pop().destroy()}}function Hi(){Ni(),Ri()}function Ui(e){var t,n;if(void 0!==globalThis.Phaser){var r=null!==(t=null==e||null===(n=e.detail)||void 0===n?void 0:n.unit)&&void 0!==t?t:Yt.activeUnit,i=r.hex;Li.spriteOnActiveUnit.setActive(!0).setVisible(!0).setPosition(i.x,i.y).setDepth(98);var o={1:{fontSize:25,x:100,y:fe/6,strokeThickness:7},.7:{fontSize:37.5,x:100,y:20,strokeThickness:8},.5:{fontSize:55,x:100,y:-10,strokeThickness:10},.4:{fontSize:65,x:100,y:-20,strokeThickness:15}}[Wi.cameras.main.zoom.toString()],a=o.fontSize,s=o.strokeThickness,u=o.x,c=o.y;["L","K","J","U","I","O"].forEach(function(e){var t=Ai(hn(e.toLowerCase(),r.row,r.col),2),n=t[0],i=t[1],o=sr.getHex({row:n,col:i});if(ur(o,r)){var l=Wi.add.text(o.x-u,o.y+c,e,{fixedWidth:fe,font:"".concat(a,"pt Trebuchet MS"),align:"center",color:"khaki",stroke:"black",strokeThickness:s}).setOrigin(0).setDepth(98);Li.shortcutKeys.push(l),Wi.cameras.getCamera("mini").ignore(l)}})}}function Ri(){var e,t=he().offscreen;null===(e=Li.spriteOnActiveTile)||void 0===e||e.setActive(!1).setPosition(t,t).setDepth(0)}function Di(e){var t,n,r;if(void 0!==globalThis.Phaser){var i=null!==(t=null==e||null===(n=e.detail)||void 0===n||null===(n=n.unit)||void 0===n?void 0:n.hex)&&void 0!==t?t:null===(r=Yt.activeUnit)||void 0===r?void 0:r.hex;Wi.cameras.main.pan(i.x,i.y,500,"Linear",!0)}}function _i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Vi(e,t){if(e){if("string"==typeof e)return zi(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zi(e,t):void 0}}function zi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Gi(e){if(Array.isArray(e))return e}function Bi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.htmlElementId,n=e.imageKey,r=e.scene,i=document.getElementById(t),o=r.textures.get(n);o instanceof Phaser.Textures.Texture&&i instanceof Element&&i.append(o.getSourceImage())}Yt.events.on("unit-deactivated",Hi),Yt.events.on("unit-moving",Hi),Yt.events.on("zoom-in",function(){var e=Wi.cameras.main.zoom,t=qi.indexOf(e);if(t<qi.length-1&&(Wi.cameras.main.zoom=qi[++t]),t>=qi.length-1){var n=document.querySelector("#zoom-in");n instanceof Element&&(n.disabled=!0)}if(t>0){var r=document.querySelector("#zoom-out");r instanceof Element&&(r.disabled=!1)}Ni(),Ui()}),Yt.events.on("zoom-out",function(){var e=Wi.cameras.main.zoom,t=qi.indexOf(e);if(t>0&&(Wi.cameras.main.zoom=qi[--t]),t<qi.length-1){var n=document.querySelector("#zoom-in");n instanceof Element&&(n.disabled=!1)}if(t<=0){var r=document.querySelector("#zoom-out");r instanceof Element&&(r.disabled=!0)}Ni(),Ui()}),Yt.events.on("hex-clicked",function(e){var t,n,r=(null===(t=e.detail)||void 0===t?void 0:t.hex)||(null===(n=e.detail)||void 0===n||null===(n=n.unit)||void 0===n?void 0:n.hex);ar(r)&&qt.isTile(r.tile)&&Qn.isHexExplored(Yt.players[0],r)&&(Li.spriteOnActiveTile.setActive(!0).setVisible(!0).setPosition(r.x,r.y).setDepth(98),Wi.cameras.main.pan(r.x,r.y,500,"Linear",!0))}),Yt.events.on("doing-action",Ri),Yt.events.on("esc-pressed",Ri),Yt.events.on("unit-activated",function(e){var t;Hi(),Ui(e),null!==(t=e.detail)&&void 0!==t&&t.skipCentering||Di(e)}),Yt.events.on("center-map",function(e){Ri(),Di(e)}),Yt.events.on("unit-created",function(e){var t,n;t=e.detail.unit,n=Wi,xi.has(t)||xi.set(t,new Si(t,n)),xi.has(t)}),Yt.events.on("goods-created",function(e){var t,n;t=e.detail.goods,n=Wi,ri.has(t)||ri.set(t,new fi(t,n)),ri.has(t)});var Ki=null;const Yi={CityView:_r,MainControls:Br,MainGame:{key:Ii,autoStart:!0,preload:function(){var e=this;Object.entries(le.terrains).forEach(function(t){var n=Ai(t,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&e.load.image("tile.".concat(r),"img/tiles/".concat(i.tile,".png"))}),this.load.spritesheet("cities","img/tiles/cities.png",{frameHeight:200,frameWidth:200}),Object.entries(le.improvements).forEach(function(t){var n=Ai(t,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&e.load.image("improvements.".concat(r),"img/improvements/".concat(i.tile,".png"))}),Object.entries(le.goods).forEach(function(t){var n=Ai(t,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&e.load.image("goods.".concat(r),"img/resources/".concat(i.tile,".png"))}),this.load.image("spoilage-timer","img/resources/hourglass.png"),Object.keys(le.laborers).forEach(function(t){e.load.image("laborers.".concat(t),"img/laborers/".concat(t,".png"))}),this.load.image("activeTile","img/activeTile.png"),this.load.image("activeUnit","img/activeUnit.png"),this.load.image("actions.cancel","img/actions/cancel.png"),le.actions.forEach(function(t){t.icon&&e.load.image("actions.".concat(t.key),"img/actions/".concat(t.icon))}),Object.keys(le.units).forEach(function(t){e.load.image("unit.".concat(t),"img/units/".concat(t,".png"))}),Yt.scenes.mainGame=this},create:function(){var e=this;Wi=this,Yt.graphics=Mi(Mi({},Yt.graphics),{},{territoryFills:this.add.graphics({x:0,y:0}).setDepth(2),territoryLines:this.add.graphics({x:0,y:0}).setDepth(2)}),sr.forEach(function(t){var n=le.world[t.row][t.col];Object.assign(t,n,{tile:new qt({hex:t}),terrain:Mi(Mi({},le.terrains[n.terrain]),{},{terrain:n.terrain}),sprite:e.add.image(t.x,t.y,"tile.".concat(n.terrain)),text:e.add.text(t.x-100,t.y+fe/3.6,t.row+"\xD7"+t.col,{fixedWidth:fe,font:"12pt Trebuchet MS",align:"center",color:"white"}).setOrigin(0)}),Yt.players.forEach(function(e){Qn.startTileFogState(e,t,"unexplored")})}).forEach(function(t){var n;"object"===Pi(null!==(n=t.city)&&void 0!==n&&n)&&(new Vn(Mi(Mi({},t.city),{},{hex:t,nation:Yt.nations[t.city.nation]})),e.add.image(t.x,t.y,"cities",t.city.nation.frame).setDepth(5).setScale(.8)),"string"==typeof t.improvement&&t.tile.setImprovement(t.improvement)});var t=he();Li.spriteOnActiveTile=this.add.image(t.offscreen,t.offscreen,"activeTile").setActive(!1),Li.spriteOnActiveUnit=this.add.image(t.offscreen,t.offscreen,"activeUnit").setActive(!1);var n=sr.pixelWidth,r=sr.pixelHeight,i=t.width/2,o=t.height/2;this.cameras.main.setBounds(-i,-o,n+2*i,r+2*o),this.cameras.main.ignore([Yt.graphics.territoryFills]);var a=400,s=800;window.innerHeight<600&&(a=300,s=500);var u=this.cameras.add(t.width-s,t.height-a,s,a);u.setZoom(.05).setName("mini").setBackgroundColor(0),u.centerOn(sr.pixelWidth/2,sr.pixelHeight/2),u.ignore([Yt.graphics.territoryLines,Li.spriteOnActiveTile,Li.spriteOnActiveUnit]),Yt.players[0].addUnit("warrior",sr.getHex({row:2,col:8}),this),Yt.players[0].addUnit("farmer",sr.getHex({row:2,col:7}),this),Yt.players[0].addUnit("farmer",sr.getHex({row:2,col:9}),this),Yt.players[0].addUnit("farmer",sr.getHex({row:3,col:8}),this),Yt.players[0].addUnit("farmer",sr.getHex({row:1,col:8}),this),Xn(),this.inputManager=new qr(this),this.events.on("pause",function(){Yt.scenes.pause("mainControls"),Hi(),Yt.domContainer.style.zIndex=0,e.inputManager.disableKeyboardInput()}).on("sleep",function(){Yt.scenes.sleep("mainControls"),Hi(),Yt.domContainer.style.zIndex=0,e.inputManager.disableKeyboardInput()}),this.events.on("resume",function(){Yt.scenes.wake("mainControls"),Yt.events.emit("unit-activated",{unit:Yt.activeUnit,skipCentering:!0}),Yt.events.emit("hex-clicked",{hex:Yt.activeTile}),e.inputManager.enableKeyboardInput()}).on("wake",function(){Yt.scenes.wake("mainControls"),Yt.events.emit("unit-activated",{unit:Yt.activeUnit,skipCentering:!0}),Yt.events.emit("hex-clicked",{hex:Yt.activeTile}),e.inputManager.enableKeyboardInput()}),this.cameras.main.setZoom(.5),this.game.events.emit("scene-created-".concat(Ii))},update:function(){var e=this;this.inputManager.update(),xi.forEach(function(e,t){if(t.deleted)Ei(t);else{if(e.x!==t.hex.x||e.y!==t.hex.y){var n=function(e,t){var n=xi.get(e);if(n)return new Promise(function(r){Yt.events.emit("unit-moving",{unit:e,priorHex:t}),n.scene.tweens.add({targets:n.sprite,x:e.hex.x,y:e.hex.y+-30,ease:"Quad.out",duration:800,yoyo:!1,onComplete:function(e){e.destroy(),r()}})})}(t,e.hex);e.update(t.hex),n.then(function(){console.log("Sam, emitting unit-moved"),Yt.events.emit("unit-moved",{unit:t,promise:n})})}e.sprite.setVisible(!0),Yt.activeUnit===t?e.sprite.setTint(16777215).setDepth(100):e.sprite.setTint(3684408).setDepth(12)}}),hi(),sr.forEach(function(t){var n,r;t.tile.improvement.key?function(e,t){var n,r=null===(n=e.improvement)||void 0===n?void 0:n.key;if(r&&!$n.has(e)){var i=t.add.image(e.hex.x,e.hex.y,"improvements.".concat(r)).setDepth(5);$n.set(e,i)}}(t.tile,e):(n=t.tile,(r=$n.get(n))&&(r.destroy(),$n.delete(n)))})}},MainMenu:{key:"mainMenu",preload:function(){},create:function(){},update:function(){}},TechTree:{key:"techTree",preload:function(){},create:function(){},update:function(){}},TileView:{key:"tile-view",preload:function(){},create:function(e){var t=this,n=e.hex;if(ar(n)&&qt.isTile(n.tile)){this.scene.pause("mainGameScene"),null!=Ki||(Ki=document.getElementById("tile-view")),Object.keys(le.laborers).forEach(function(e){t.load.image("laborers.".concat(e),"img/laborers/".concat(e,".png"))}),Object.entries(le.improvements).forEach(function(e){var n=function(e,t){return Gi(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||Vi(e,t)||_i()}(e,2),r=n[0],i=n[1];"string"==typeof i.tile&&i.tile.length>0&&t.load.image("improvements.".concat(r),"img/improvements/".concat(i.tile,".png"))});var r=Ki.querySelector(".btn-close");r instanceof Element&&r.addEventListener("click",function(){t.scene.stop("tile-view")}),Bi({imageKey:"tile.".concat(n.terrain.terrain),htmlElementId:"terrain",scene:this});var i=Ki.querySelector("#terrain");if(i instanceof Element){var o=document.createElement("div");o.classList.add("name"),o.innerHTML=n.terrain.name,i.appendChild(o)}if(n.tile.improvement){var a=Ki.querySelector("#improvements"),s=t.textures.exists("tile-view-improvement")?t.textures.get("tile-view-improvement"):t.textures.createCanvas("tile-view-improvement",fe,fe),u=s.getCanvas(),c=s.getContext(),l=F({dimensions:100,orientation:P.FLAT,origin:"topLeft"}),f=new oe(l,X({width:1,height:1})).getHex({row:0,col:0});c.fillStyle="white",c.beginPath();var h=function(e){return Gi(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Vi(e)||_i()}(f.corners.map(function(e){return ye({x:e.x,y:e.y-f.y+100},{x:f.y,y:f.y},.8)})),y=h[0],d=h.slice(1);c.moveTo(y.x,y.y),d.forEach(function(e){var t=e.x,n=e.y;c.lineTo(t,n)}),c.closePath(),c.fill();var v=this.textures.get("improvements.".concat(n.tile.improvement.key)).getSourceImage(),p=(s.width-v.width)/2-2,m=(s.height-v.height)/2;s.drawFrame("improvements.".concat(n.tile.improvement.key),null,p,m),s.refresh(),a.appendChild(u);var b=document.createElement("div");b.classList.add("name"),b.innerHTML=n.tile.improvement.title,a.appendChild(b),console.log("Sam, improvement:",n.tile.improvement)}n.tile.laborers instanceof Set?(Ki.querySelector("#laborers"),n.tile.laborers.forEach(function(e){Bi({imageKey:"laborers.".concat(e.type),htmlElementId:"laborers",scene:t})})):console.log("Sam, no laborers set\u2026"),Ki.removeAttribute("hidden"),this.inputManager=new qr(this),this.events.on("sleep",function(){Ki.setAttribute("hidden",!0),Ki.querySelectorAll("div").forEach(function(e){return e.hasAttribute("id")&&(e.innerHTML="")}),t.scene.wake("mainGameScene"),t.inputManager.disableKeyboardInput()}).on("shutdown",function(){Ki.setAttribute("hidden",!0),Ki.querySelectorAll("div").forEach(function(e){return e.hasAttribute("id")&&(e.innerHTML="")}),t.scene.wake("mainGameScene")})}else Yt.scenes.resume("mainGameScene")},update:function(){}}};void 0===globalThis.document&&(globalThis.document={add:function(){return this},addEventListener:function(){return this},appendChild:function(){return this},createElement:function(){return this},getElementById:function(){return this},querySelector:function(){return this},querySelectorAll:function(){return[]},remove:function(){return this},removeAttribute:function(){return this},setAttribute:function(){return this}},globalThis.document.classList=globalThis.document,globalThis.document.style=globalThis.document);var Qi=null;function Xi(e,t,n){var r=document.createElement("button");Yt.scenes.mainGame.textures.exists("actions.".concat(n.key))?r.append(Yt.scenes.mainGame.textures.get("actions.".concat(n.key)).getSourceImage()):r.innerHTML=n.label,r.addEventListener("click",function(){n.execute(t)}),"string"==typeof n.description&&""!==n.description&&r.setAttribute("title",n.description),r.style.pointerEvents="auto",e.appendChild(r)}function Ji(){Qi.unitMenu.innerHTML="",Qi.unitMenu.setAttribute("hidden",!0)}function $i(e){Yt.activeTile=null,Qi.tileMenu.setAttribute("hidden",!0),Qi.tileMenu.innerHTML=""}Yt.events.on("phaser-ready",function(){null!=Qi||(Qi={menus:document.getElementById("action-menus"),tileMenu:document.getElementById("tile-menu"),unitMenu:document.getElementById("unit-menu")})}),Yt.events.on("unit-activated",function(e){var t,n=null===(t=e.detail)||void 0===t?void 0:t.unit;if(pn.isUnit(n)&&Yt.activeUnit===n&&"undefined"!=typeof Element&&Yt.domContainer instanceof Element){Ji();var r=Yt.currentPlayer,i={menu:"unit-actions-menu",hex:n.hex,unit:n,faction:r};xr.getAvailableActions(i).forEach(Xi.bind(null,Qi.unitMenu,i)),Qi.unitMenu.removeAttribute("hidden"),Qi.menus.removeAttribute("hidden")}}),Yt.events.on("unit-deactivated",Ji),Yt.events.on("unit-moving",Ji),Yt.events.on("doing-action",function(){Ji(),$i()}),Yt.events.on("hex-clicked",function(e){var t,n=null===(t=e.detail)||void 0===t?void 0:t.hex;if(ar(n)&&qt.isTile(n.tile)&&Qn.isHexExplored(Yt.players[0],n)){$i();var r={menu:"tile-menu",hex:n,unit:Yt.activeUnit,faction:Yt.currentPlayer},i=xr.getAvailableActions(r);if(0!==i.length)if(1!==i.length||"activateUnit"===i[0].key){Yt.activeTile=n,i.forEach(Xi.bind(null,Qi.tileMenu,r));var o=document.createElement("button");Yt.scenes.mainGame.textures.exists("actions.cancel")?o.append(Yt.scenes.mainGame.textures.get("actions.cancel").getSourceImage()):o.innerHTML="Cancel",o.addEventListener("click",function(){Yt.events.emit("esc-pressed")}),o.style.pointerEvents="auto",Qi.tileMenu.appendChild(o),Qi.tileMenu.style.zIndex=1,Qi.tileMenu.removeAttribute("hidden"),Qi.menus.removeAttribute("hidden")}else i[0].execute(r)}}),Yt.events.on("esc-pressed",$i),Yt.events.on("center-map",$i),yodasws.page("pageGame").setRoute({template:"pages/game/game.html",canonicalRoute:"/game/",route:"/game/?"}).on("load",()=>{Yt.nations=[new mt({index:0})],Yt.players=[new Cn({index:0}),new Cn({index:1}),new Cn({index:2})];const e=new Phaser.Game({type:Phaser.AUTO,...he(),zoom:.5,backgroundColor:"#000000",scene:{key:"title-screen",preload(){},create(){},update(){}},parent:document.querySelector("main"),dom:{createContainer:!0}});Promise.all(Object.values(Yi).map(t=>(e.scene.add(t.key,t,t.autoStart||!1),!t.autoStart||new Promise(n=>{e.events.once(`scene-created-${t.key}`,n)})))).then(()=>{Yt.events.emit("phaser-ready")}).then(()=>{e.scene.moveAbove("mainGameScene","mainControls"),e.scene.isActive("mainGameScene")&&e.scene.isActive("mainControls")&&Yt.startRound()}),Object.assign(Yt,{scenes:e.scene,domContainer:e.domContainer}),e.domContainer.classList.add("game")}),window.json={},yodasws.page("home").setRoute({template:"pages/home.html",route:"/"}).on("load",()=>{})})();